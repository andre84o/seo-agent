{"version":3,"sources":["../../lib/db/supabase.ts","../../lib/db/operations.ts","../../lib/ai/openai-client.ts","../../lib/mcp/fetch-url.ts","../../lib/mcp/read-sitemap.ts","../../lib/mcp/psi-audit.ts","../../lib/mcp/gsc-top-queries.ts","../../lib/seo/on-page-analysis.ts","../../lib/seo/scoring.ts","../../lib/agent/core.ts","../../lib/analytics/google-analytics.ts","../../lib/seo/content-optimizer.ts","../../lib/fetchserp/client.ts"],"names":["createClient","OpenAI","axios","XMLParser","cheerio","google","cheerio2"],"mappings":"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","file":"index.js","sourcesContent":["// Supabase Client Setup\n// Konfigurerar Supabase client fr server-side anvndning\n\nimport { createClient } from '@supabase/supabase-js';\nimport type { Database } from './types';\n\n// Hmta env-variabler utan att kasta vid import (undviker build-fel)\nconst SUPABASE_URL = process.env.NEXT_PUBLIC_SUPABASE_URL || '';\nconst SUPABASE_SERVICE_KEY = process.env.SUPABASE_SERVICE_ROLE_KEY || '';\n\n// Skapa Supabase client med service role (full access)\nexport const supabase: any = createClient<Database>(\n  SUPABASE_URL,\n  SUPABASE_SERVICE_KEY,\n  {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  }\n);\n\n// Anon client fr UI (med RLS)\nexport function createAnonClient() {\n  const url = process.env.NEXT_PUBLIC_SUPABASE_URL || '';\n  const anon = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || '';\n\n  return createClient<Database>(url, anon);\n}\n","// Database Operations\n// CRUD operationer och queries fr SEO-agenten\n\nimport { supabase } from './supabase';\nimport type { Database } from './types';\n\ntype PageRow = Database['public']['Tables']['pages']['Row'];\ntype PageInsert = Database['public']['Tables']['pages']['Insert'];\ntype PageUpdate = Database['public']['Tables']['pages']['Update'];\ntype RunRow = Database['public']['Tables']['runs']['Row'];\ntype RunInsert = Database['public']['Tables']['runs']['Insert'];\ntype AuditInsert = Database['public']['Tables']['audits']['Insert'];\ntype AuditRow = Database['public']['Tables']['audits']['Row'];\ntype SuggestionInsert = Database['public']['Tables']['suggestions']['Insert'];\ntype SuggestionRow = Database['public']['Tables']['suggestions']['Row'];\ntype GSCDailyInsert = Database['public']['Tables']['gsc_daily']['Insert'];\n\n// ============================================================================\n// RUNS\n// ============================================================================\n\n/**\n * Skapar en ny run\n */\nexport async function createRun(): Promise<number> {\n  // Cast to any to avoid TS type narrowing issues when Database types are out of sync\n  const { data, error } = await (supabase as any)\n    .from('runs')\n    .insert({\n      started_at: new Date().toISOString(),\n      status: 'running',\n    })\n    .select('run_id')\n    .single();\n\n  if (error) throw new Error(`Failed to create run: ${error.message}`);\n  return data.run_id;\n}\n\n/**\n * Uppdaterar en run med resultat\n */\nexport async function updateRun(\n  runId: number,\n  update: {\n    finished_at?: string;\n    pages_checked?: number;\n    avg_score?: number;\n    status?: string;\n    error_message?: string;\n  }\n): Promise<void> {\n  const { error } = await (supabase as any)\n    .from('runs')\n    .update(update)\n    .eq('run_id', runId);\n\n  if (error) throw new Error(`Failed to update run: ${error.message}`);\n}\n\n/**\n * Hmtar senaste runs\n */\nexport async function getRecentRuns(limit = 10): Promise<RunRow[]> {\n  const { data, error } = await supabase\n    .from('runs')\n    .select('*')\n    .order('started_at', { ascending: false })\n    .limit(limit);\n\n  if (error) throw new Error(`Failed to fetch runs: ${error.message}`);\n  return data || [];\n}\n\n// ============================================================================\n// PAGES\n// ============================================================================\n\n/**\n * Upsertar en page (insert eller update om URL finns)\n */\nexport async function upsertPage(page: PageInsert): Promise<void> {\n  const { error } = await supabase\n    .from('pages')\n    .upsert(page, { onConflict: 'url' });\n\n  if (error) throw new Error(`Failed to upsert page: ${error.message}`);\n}\n\n/**\n * Uppdaterar senaste mtvrden fr en page\n */\nexport async function updatePageMetrics(\n  url: string,\n  metrics: {\n    senaste_score: number;\n    senaste_lcp?: number;\n    senaste_cls?: number;\n    senaste_inp?: number;\n    last_seen_at?: string;\n  }\n): Promise<void> {\n  const { error } = await supabase\n    .from('pages')\n    .update({\n      ...metrics,\n      last_seen_at: metrics.last_seen_at || new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n    })\n    .eq('url', url);\n\n  if (error) throw new Error(`Failed to update page metrics: ${error.message}`);\n}\n\n/**\n * Hmtar alla pages\n */\nexport async function getAllPages(): Promise<PageRow[]> {\n  const { data, error } = await supabase\n    .from('pages')\n    .select('*')\n    .order('updated_at', { ascending: false });\n\n  if (error) throw new Error(`Failed to fetch pages: ${error.message}`);\n  return data || [];\n}\n\n/**\n * Hmtar en page via URL\n */\nexport async function getPageByUrl(url: string): Promise<PageRow | null> {\n  const { data, error } = await supabase\n    .from('pages')\n    .select('*')\n    .eq('url', url)\n    .single();\n\n  if (error) {\n    if (error.code === 'PGRST116') return null; // Not found\n    throw new Error(`Failed to fetch page: ${error.message}`);\n  }\n  return data;\n}\n\n/**\n * Hmtar pages med dlig score (under threshold)\n */\nexport async function getPagesWithLowScore(threshold = 50): Promise<PageRow[]> {\n  const { data, error } = await supabase\n    .from('pages')\n    .select('*')\n    .lt('senaste_score', threshold)\n    .order('senaste_score', { ascending: true });\n\n  if (error) throw new Error(`Failed to fetch low score pages: ${error.message}`);\n  return data || [];\n}\n\n// ============================================================================\n// AUDITS\n// ============================================================================\n\n/**\n * Skapar en ny audit\n */\nexport async function createAudit(audit: AuditInsert): Promise<number> {\n  const { data, error } = await supabase\n    .from('audits')\n    .insert(audit)\n    .select('audit_id')\n    .single();\n\n  if (error) {\n    // Kolla fr duplicate (idempotens)\n    if (error.code === '23505') {\n      throw new Error(`Audit already exists for URL in this run`);\n    }\n    throw new Error(`Failed to create audit: ${error.message}`);\n  }\n\n  return data.audit_id;\n}\n\n/**\n * Hmtar audits fr en specifik run\n */\nexport async function getAuditsByRun(runId: number): Promise<AuditRow[]> {\n  const { data, error } = await supabase\n    .from('audits')\n    .select('*')\n    .eq('run_id', runId)\n    .order('score', { ascending: true });\n\n  if (error) throw new Error(`Failed to fetch audits: ${error.message}`);\n  return data || [];\n}\n\n/**\n * Hmtar audits fr en specifik URL\n */\nexport async function getAuditsByUrl(url: string, limit = 10): Promise<AuditRow[]> {\n  const { data, error } = await supabase\n    .from('audits')\n    .select('*')\n    .eq('url', url)\n    .order('created_at', { ascending: false })\n    .limit(limit);\n\n  if (error) throw new Error(`Failed to fetch audits for URL: ${error.message}`);\n  return data || [];\n}\n\n/**\n * Hmtar senaste audit fr varje URL (frn materialiserad vy)\n */\nexport async function getLatestAudits(): Promise<any[]> {\n  const { data, error } = await supabase\n    .from('latest_audits')\n    .select('*')\n    .order('score', { ascending: true });\n\n  if (error) throw new Error(`Failed to fetch latest audits: ${error.message}`);\n  return data || [];\n}\n\n/**\n * Hmtar smsta sidor senaste veckan (frn materialiserad vy)\n */\nexport async function getWorstPagesWeek(): Promise<any[]> {\n  const { data, error } = await supabase\n    .from('worst_pages_week')\n    .select('*')\n    .limit(20);\n\n  if (error) throw new Error(`Failed to fetch worst pages: ${error.message}`);\n  return data || [];\n}\n\n// ============================================================================\n// SUGGESTIONS\n// ============================================================================\n\n/**\n * Skapar ett nytt frslag\n */\nexport async function createSuggestion(suggestion: SuggestionInsert): Promise<number> {\n  const { data, error } = await supabase\n    .from('suggestions')\n    .insert(suggestion)\n    .select('suggestion_id')\n    .single();\n\n  if (error) throw new Error(`Failed to create suggestion: ${error.message}`);\n  return data.suggestion_id;\n}\n\n/**\n * Uppdaterar status p ett frslag\n */\nexport async function updateSuggestionStatus(\n  suggestionId: number,\n  status: 'pending' | 'in_progress' | 'completed' | 'dismissed'\n): Promise<void> {\n  const { error } = await supabase\n    .from('suggestions')\n    .update({\n      status,\n      updated_at: new Date().toISOString(),\n    })\n    .eq('suggestion_id', suggestionId);\n\n  if (error) throw new Error(`Failed to update suggestion: ${error.message}`);\n}\n\n/**\n * Hmtar suggestions filtrerade p status och impact\n */\nexport async function getSuggestions(filters?: {\n  status?: string;\n  impact?: string;\n  url?: string;\n}): Promise<SuggestionRow[]> {\n  let query = supabase\n    .from('suggestions')\n    .select('*')\n    .order('created_at', { ascending: false });\n\n  if (filters?.status) {\n    query = query.eq('status', filters.status);\n  }\n\n  if (filters?.impact) {\n    query = query.eq('impact', filters.impact);\n  }\n\n  if (filters?.url) {\n    query = query.eq('url', filters.url);\n  }\n\n  const { data, error } = await query;\n\n  if (error) throw new Error(`Failed to fetch suggestions: ${error.message}`);\n  return data || [];\n}\n\n/**\n * Hmtar topp 5 frslag per impact\n */\nexport async function getTopSuggestions(): Promise<{\n  high: SuggestionRow[];\n  medium: SuggestionRow[];\n  low: SuggestionRow[];\n}> {\n  const [high, medium, low] = await Promise.all([\n    getSuggestions({ impact: 'high', status: 'pending' }),\n    getSuggestions({ impact: 'medium', status: 'pending' }),\n    getSuggestions({ impact: 'low', status: 'pending' }),\n  ]);\n\n  return {\n    high: high.slice(0, 5),\n    medium: medium.slice(0, 5),\n    low: low.slice(0, 5),\n  };\n}\n\n// ============================================================================\n// GSC DAILY\n// ============================================================================\n\n/**\n * Upsertar GSC daily data\n */\nexport async function upsertGSCDaily(data: GSCDailyInsert): Promise<void> {\n  const { error } = await supabase\n    .from('gsc_daily')\n    .upsert(data, { onConflict: 'url,date' });\n\n  if (error) throw new Error(`Failed to upsert GSC data: ${error.message}`);\n}\n\n/**\n * Batch insert GSC daily data\n */\nexport async function batchInsertGSCDaily(data: GSCDailyInsert[]): Promise<void> {\n  const { error } = await supabase\n    .from('gsc_daily')\n    .upsert(data, { onConflict: 'url,date' });\n\n  if (error) throw new Error(`Failed to batch insert GSC data: ${error.message}`);\n}\n\n/**\n * Hmtar GSC data fr en URL\n */\nexport async function getGSCDataByUrl(url: string, days = 30): Promise<any[]> {\n  const startDate = new Date();\n  startDate.setDate(startDate.getDate() - days);\n\n  const { data, error } = await supabase\n    .from('gsc_daily')\n    .select('*')\n    .eq('url', url)\n    .gte('date', startDate.toISOString().split('T')[0])\n    .order('date', { ascending: false });\n\n  if (error) throw new Error(`Failed to fetch GSC data: ${error.message}`);\n  return data || [];\n}\n\n// ============================================================================\n// AI ANALYSIS HISTORY\n// ============================================================================\n\n/**\n * Sparar AI-analys historik\n */\nexport async function createAIAnalysis(analysis: {\n  page_id: number;\n  run_id?: number;\n  analysis_type?: string;\n  ai_summary: string;\n  ai_score: number;\n  suggestions_count: number;\n  used_gsc_data?: boolean;\n  used_analytics_data?: boolean;\n  used_psi_data?: boolean;\n  title_suggestions?: unknown;\n  meta_suggestions?: unknown;\n  faq_suggestions?: unknown;\n  content_outline?: unknown;\n  keywords?: unknown;\n  full_response?: unknown;\n  model_used?: string;\n  tokens_used?: number;\n  analysis_duration_ms?: number;\n}): Promise<number> {\n  const { data, error } = await (supabase as any)\n    .from('ai_analysis_history')\n    .insert(analysis)\n    .select('id')\n    .single();\n\n  if (error) throw new Error(`Failed to create AI analysis: ${error.message}`);\n  return data.id;\n}\n\n/**\n * Hmtar AI-analyser fr en sida\n */\nexport async function getAIAnalysesByPageId(pageId: number, limit = 10): Promise<any[]> {\n  const { data, error } = await supabase\n    .from('ai_analysis_history')\n    .select('*')\n    .eq('page_id', pageId)\n    .order('created_at', { ascending: false })\n    .limit(limit);\n\n  if (error) throw new Error(`Failed to fetch AI analyses: ${error.message}`);\n  return data || [];\n}\n\n// ============================================================================\n// SEO TASKS (TODO-SYSTEM)\n// ============================================================================\n\n/**\n * Skapar en ny SEO task\n */\nexport async function createTask(task: {\n  page_id: number;\n  suggestion_id?: number;\n  title: string;\n  description?: string;\n  task_type?: string;\n  priority?: 'high' | 'medium' | 'low';\n  status?: 'todo' | 'in_progress' | 'done' | 'skipped';\n  ai_generated?: boolean;\n  expected_impact?: string;\n  effort_estimate?: string;\n  assigned_to?: string;\n  due_date?: string;\n  notes?: string;\n}): Promise<number> {\n  const { data, error } = await (supabase as any)\n    .from('seo_tasks')\n    .insert(task)\n    .select('id')\n    .single();\n\n  if (error) throw new Error(`Failed to create task: ${error.message}`);\n  return data.id;\n}\n\n/**\n * Uppdaterar en task\n */\nexport async function updateTask(\n  taskId: number,\n  update: {\n    status?: string;\n    assigned_to?: string;\n    completed_at?: string;\n    completed_by?: string;\n    notes?: string;\n  }\n): Promise<void> {\n  const { error } = await supabase\n    .from('seo_tasks')\n    .update(update)\n    .eq('id', taskId);\n\n  if (error) throw new Error(`Failed to update task: ${error.message}`);\n}\n\n/**\n * Hmtar tasks fr en sida\n */\nexport async function getTasksByPageId(pageId: number): Promise<any[]> {\n  const { data, error } = await supabase\n    .from('seo_tasks')\n    .select('*')\n    .eq('page_id', pageId)\n    .order('priority', { ascending: true })\n    .order('created_at', { ascending: false });\n\n  if (error) throw new Error(`Failed to fetch tasks: ${error.message}`);\n  return data || [];\n}\n\n/**\n * Hmtar alla aktiva tasks (denna veckans prioriterade)\n */\nexport async function getActiveTasksThisWeek(): Promise<any[]> {\n  // Try the view first\n  const { data, error } = await supabase\n    .from('this_week_priority_tasks')\n    .select('*');\n\n  // If view doesn't exist or has issues, fallback to direct query\n  if (error) {\n    console.warn('View this_week_priority_tasks not available, using fallback query:', error.message);\n\n    // Fallback: query seo_tasks directly\n    const { data: fallbackData, error: fallbackError } = await supabase\n      .from('seo_tasks')\n      .select('*')\n      .in('status', ['todo', 'in_progress'])\n      .order('priority', { ascending: true })\n      .order('created_at', { ascending: false });\n\n    if (fallbackError) {\n      throw new Error(`Failed to fetch tasks: ${fallbackError.message}`);\n    }\n    return fallbackData || [];\n  }\n\n  return data || [];\n}\n\n/**\n * Hmtar pending AI-suggestions som inte r tasks n\n */\nexport async function getPendingAISuggestions(): Promise<any[]> {\n  // Try the view first\n  const { data, error } = await supabase\n    .from('pending_ai_suggestions')\n    .select('*');\n\n  // If view doesn't exist, fallback to direct query\n  if (error) {\n    console.warn('View pending_ai_suggestions not available, using fallback query:', error.message);\n\n    // Fallback: query suggestions directly\n    const { data: fallbackData, error: fallbackError } = await supabase\n      .from('suggestions')\n      .select('*')\n      .eq('ai_generated', true)\n      .eq('status', 'pending')\n      .order('created_at', { ascending: false });\n\n    if (fallbackError) {\n      throw new Error(`Failed to fetch suggestions: ${fallbackError.message}`);\n    }\n    return fallbackData || [];\n  }\n\n  return data || [];\n}\n\n// ============================================================================\n// CONTENT VERSIONS\n// ============================================================================\n\n/**\n * Sparar en content version (fre/efter ndring)\n */\nexport async function createContentVersion(version: {\n  page_id: number;\n  task_id?: number;\n  version_number: number;\n  version_type: string;\n  previous_value?: string;\n  new_value: string;\n  changed_by?: string;\n  change_reason?: string;\n  ai_suggested?: boolean;\n  previous_metrics?: unknown;\n  notes?: string;\n}): Promise<number> {\n  const { data, error } = await (supabase as any)\n    .from('content_versions')\n    .insert(version)\n    .select('id')\n    .single();\n\n  if (error) throw new Error(`Failed to create content version: ${error.message}`);\n  return data.id;\n}\n\n/**\n * Hmtar content versions fr en sida\n */\nexport async function getContentVersionsByPageId(pageId: number): Promise<any[]> {\n  const { data, error } = await supabase\n    .from('content_versions')\n    .select('*')\n    .eq('page_id', pageId)\n    .order('implemented_at', { ascending: false });\n\n  if (error) throw new Error(`Failed to fetch content versions: ${error.message}`);\n  return data || [];\n}\n\n// ============================================================================\n// UTILITIES\n// ============================================================================\n\n/**\n * Refreshar materialiserade vyer\n */\nexport async function refreshMaterializedViews(): Promise<void> {\n  const { error } = await supabase.rpc('refresh_materialized_views');\n\n  if (error) throw new Error(`Failed to refresh views: ${error.message}`);\n}\n\n/**\n * Kr retention cleanup\n */\nexport async function runRetentionCleanup(): Promise<any> {\n  const { data, error } = await supabase.rpc('run_retention_cleanup');\n\n  if (error) throw new Error(`Failed to run retention cleanup: ${error.message}`);\n  return data;\n}\n","// OpenAI Client - AI-driven SEO Analysis\r\n// Hjrnan i SEO-manager systemet\r\n\r\nimport OpenAI from 'openai';\r\nimport type { GSCPageData } from '../mcp/gsc-top-queries';\r\n\r\n// Initialisera OpenAI klient\r\nconst openai = new OpenAI({\r\n  apiKey: process.env.OPENAI_API_KEY || '',\r\n});\r\n\r\nexport interface SEOAnalysisInput {\r\n  url: string;\r\n  currentTitle?: string;\r\n  currentMetaDescription?: string;\r\n  currentH1?: string;\r\n  contentLength?: number;\r\n  gscData?: GSCPageData;\r\n  psiScore?: number;\r\n  psiMetrics?: {\r\n    fcp?: number;\r\n    lcp?: number;\r\n    cls?: number;\r\n    tbt?: number;\r\n  };\r\n  competitors?: string[];\r\n  language?: string;\r\n}\r\n\r\nexport interface SEOSuggestion {\r\n  type: 'title' | 'meta_description' | 'h1' | 'content' | 'faq' | 'schema' | 'performance';\r\n  priority: 'high' | 'medium' | 'low';\r\n  category: string;\r\n  suggestion: string;\r\n  reasoning: string;\r\n  expectedImpact: string;\r\n  implementation?: string;\r\n}\r\n\r\nexport interface AIAnalysisResult {\r\n  summary: string;\r\n  score: number; // 0-100\r\n  suggestions: SEOSuggestion[];\r\n  titleSuggestions: string[];\r\n  metaDescriptionSuggestions: string[];\r\n  faqSuggestions?: {\r\n    question: string;\r\n    answer: string;\r\n  }[];\r\n  contentOutline?: string[];\r\n  keywords: {\r\n    primary: string[];\r\n    secondary: string[];\r\n    longTail: string[];\r\n  };\r\n}\r\n\r\n/**\r\n * Genererar en omfattande SEO-analys med AI\r\n */\r\nexport async function analyzePageWithAI(\r\n  input: SEOAnalysisInput\r\n): Promise<AIAnalysisResult> {\r\n  // Kolla om API-nyckel finns\r\n  if (!process.env.OPENAI_API_KEY) {\r\n    throw new Error('OPENAI_API_KEY saknas i environment variables');\r\n  }\r\n\r\n  const systemPrompt = `Du r en expert SEO-konsult som analyserar webbsidor och ger konkreta, prioriterade frbttringsfrslag.\r\n\r\nDin uppgift:\r\n1. Analysera sidans nuvarande SEO-status\r\n2. Identifiera frbttringsmjligheter baserat p GSC-data (klick, impressions, CTR, position)\r\n3. Ge konkreta, implementerbara frslag\r\n4. Prioritera baserat p frvntad effekt\r\n\r\nFokusera p:\r\n- Title och meta description optimering fr hgre CTR\r\n- Content-kvalitet och relevans\r\n- Anvndarintention och skbeteende\r\n- Teknisk SEO (om performance-data finns)\r\n- Strukturerad data (FAQ, schema.org)\r\n\r\nSvara alltid p svenska med konkreta exempel.`;\r\n\r\n  const userPrompt = buildAnalysisPrompt(input);\r\n\r\n  try {\r\n    const completion = await openai.chat.completions.create({\r\n      model: 'gpt-4o',\r\n      messages: [\r\n        { role: 'system', content: systemPrompt },\r\n        { role: 'user', content: userPrompt },\r\n      ],\r\n      temperature: 0.7,\r\n      response_format: { type: 'json_object' },\r\n    });\r\n\r\n    const result = completion.choices[0].message.content;\r\n    if (!result) {\r\n      throw new Error('Ingen respons frn OpenAI');\r\n    }\r\n\r\n    const parsed = JSON.parse(result) as AIAnalysisResult;\r\n    return parsed;\r\n  } catch (error) {\r\n    console.error('[OpenAI] Analysis error:', error);\r\n    throw new Error(\r\n      `AI-analys misslyckades: ${error instanceof Error ? error.message : 'Unknown error'}`\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Bygger prompten fr AI-analysen\r\n */\r\nfunction buildAnalysisPrompt(input: SEOAnalysisInput): string {\r\n  let prompt = `Analysera fljande webbsida och ge konkreta SEO-frbttringar:\\n\\n`;\r\n  prompt += `URL: ${input.url}\\n`;\r\n  prompt += `Sprk: ${input.language || 'svenska'}\\n\\n`;\r\n\r\n  // Nuvarande SEO-data\r\n  if (input.currentTitle) {\r\n    prompt += `Nuvarande title: \"${input.currentTitle}\"\\n`;\r\n  }\r\n  if (input.currentMetaDescription) {\r\n    prompt += `Nuvarande meta description: \"${input.currentMetaDescription}\"\\n`;\r\n  }\r\n  if (input.currentH1) {\r\n    prompt += `Nuvarande H1: \"${input.currentH1}\"\\n`;\r\n  }\r\n  if (input.contentLength) {\r\n    prompt += `Content-lngd: ${input.contentLength} tecken\\n`;\r\n  }\r\n  prompt += '\\n';\r\n\r\n  // Google Search Console data\r\n  if (input.gscData) {\r\n    prompt += `Google Search Console data:\\n`;\r\n    prompt += `- Klick: ${input.gscData.clicks}\\n`;\r\n    prompt += `- Impressions: ${input.gscData.impressions}\\n`;\r\n    prompt += `- CTR: ${(input.gscData.ctr * 100).toFixed(2)}%\\n`;\r\n    prompt += `- Genomsnittlig position: ${input.gscData.position.toFixed(1)}\\n\\n`;\r\n\r\n    if (input.gscData.topQueries && input.gscData.topQueries.length > 0) {\r\n      prompt += `Top queries:\\n`;\r\n      input.gscData.topQueries.slice(0, 10).forEach((q, i) => {\r\n        prompt += `${i + 1}. \"${q.query}\" - ${q.clicks} klick, pos ${q.position.toFixed(1)}, CTR ${(q.ctr * 100).toFixed(1)}%\\n`;\r\n      });\r\n      prompt += '\\n';\r\n    }\r\n  }\r\n\r\n  // PageSpeed Insights data\r\n  if (input.psiScore !== undefined) {\r\n    prompt += `PageSpeed Insights:\\n`;\r\n    prompt += `- Performance score: ${input.psiScore}/100\\n`;\r\n    if (input.psiMetrics) {\r\n      if (input.psiMetrics.lcp) prompt += `- LCP: ${input.psiMetrics.lcp}s\\n`;\r\n      if (input.psiMetrics.fcp) prompt += `- FCP: ${input.psiMetrics.fcp}s\\n`;\r\n      if (input.psiMetrics.cls) prompt += `- CLS: ${input.psiMetrics.cls}\\n`;\r\n      if (input.psiMetrics.tbt) prompt += `- TBT: ${input.psiMetrics.tbt}ms\\n`;\r\n    }\r\n    prompt += '\\n';\r\n  }\r\n\r\n  prompt += `Ge mig ett JSON-svar med fljande struktur:\r\n{\r\n  \"summary\": \"Kort sammanfattning av sidans SEO-status (2-3 meningar)\",\r\n  \"score\": 75,\r\n  \"suggestions\": [\r\n    {\r\n      \"type\": \"title\",\r\n      \"priority\": \"high\",\r\n      \"category\": \"On-page SEO\",\r\n      \"suggestion\": \"Konkret frslag\",\r\n      \"reasoning\": \"Varfr detta r viktigt\",\r\n      \"expectedImpact\": \"Frvntad effekt (t.ex. '+15% CTR', 'Bttre ranking')\",\r\n      \"implementation\": \"Hur man implementerar (valfritt)\"\r\n    }\r\n  ],\r\n  \"titleSuggestions\": [\"Frslag 1\", \"Frslag 2\", \"Frslag 3\"],\r\n  \"metaDescriptionSuggestions\": [\"Frslag 1\", \"Frslag 2\"],\r\n  \"faqSuggestions\": [\r\n    {\r\n      \"question\": \"Vanlig frga baserad p skord\",\r\n      \"answer\": \"Kort, informativt svar\"\r\n    }\r\n  ],\r\n  \"contentOutline\": [\"Rubrik 1\", \"Rubrik 2\", \"Rubrik 3\"],\r\n  \"keywords\": {\r\n    \"primary\": [\"huvudskord\"],\r\n    \"secondary\": [\"relaterade skord\"],\r\n    \"longTail\": [\"long-tail varianter\"]\r\n  }\r\n}\r\n\r\nPrioritera frslag baserat p:\r\n1. GSC-data (lg CTR men mnga impressions = fokusera p title/meta)\r\n2. Position (nra topp 10 = sm ndringar kan ge stor effekt)\r\n3. Performance (lngsam sida = tekniska frbttringar viktiga)\r\n\r\nGe minst 5 konkreta suggestions.`;\r\n\r\n  return prompt;\r\n}\r\n\r\n/**\r\n * Genererar content-optimeringsfrslag\r\n */\r\nexport async function generateContentSuggestions(\r\n  url: string,\r\n  currentContent: string,\r\n  targetKeywords: string[]\r\n): Promise<{\r\n  outline: string[];\r\n  sections: { heading: string; content: string }[];\r\n  internalLinkSuggestions: string[];\r\n}> {\r\n  // Kolla om API-nyckel finns\r\n  if (!process.env.OPENAI_API_KEY) {\r\n    throw new Error('OPENAI_API_KEY saknas i environment variables');\r\n  }\r\n\r\n  const prompt = `Analysera fljande content och ge frbttringsfrslag fr SEO:\r\n\r\nURL: ${url}\r\nTarget keywords: ${targetKeywords.join(', ')}\r\n\r\nNuvarande content (frsta 500 tecken):\r\n${currentContent.slice(0, 500)}\r\n\r\nGe mig ett JSON-svar med:\r\n{\r\n  \"outline\": [\"Freslagen struktur med rubriker\"],\r\n  \"sections\": [\r\n    {\r\n      \"heading\": \"H2-rubrik\",\r\n      \"content\": \"Frslag p textinnehll (2-3 stycken)\"\r\n    }\r\n  ],\r\n  \"internalLinkSuggestions\": [\"Frslag p interna lnkar baserat p keywords\"]\r\n}`;\r\n\r\n  try {\r\n    const completion = await openai.chat.completions.create({\r\n      model: 'gpt-4o',\r\n      messages: [\r\n        {\r\n          role: 'system',\r\n          content: 'Du r en SEO content-expert som optimerar text fr skord och anvndarupplevelse.',\r\n        },\r\n        { role: 'user', content: prompt },\r\n      ],\r\n      temperature: 0.8,\r\n      response_format: { type: 'json_object' },\r\n    });\r\n\r\n    const result = completion.choices[0].message.content;\r\n    if (!result) {\r\n      throw new Error('Ingen respons frn OpenAI');\r\n    }\r\n\r\n    return JSON.parse(result);\r\n  } catch (error) {\r\n    console.error('[OpenAI] Content generation error:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Genererar schema.org markup\r\n */\r\nexport async function generateSchemaMarkup(\r\n  pageType: 'article' | 'product' | 'faq' | 'local-business',\r\n  pageData: Record<string, unknown>\r\n): Promise<Record<string, unknown>> {\r\n  const prompt = `Generera schema.org JSON-LD markup fr fljande:\r\n\r\nPage type: ${pageType}\r\nData: ${JSON.stringify(pageData, null, 2)}\r\n\r\nGe endast valid JSON-LD enligt schema.org spec.`;\r\n\r\n  try {\r\n    const completion = await openai.chat.completions.create({\r\n      model: 'gpt-4o',\r\n      messages: [\r\n        {\r\n          role: 'system',\r\n          content: 'Du r en expert p strukturerad data och schema.org markup.',\r\n        },\r\n        { role: 'user', content: prompt },\r\n      ],\r\n      temperature: 0.3,\r\n      response_format: { type: 'json_object' },\r\n    });\r\n\r\n    const result = completion.choices[0].message.content;\r\n    if (!result) {\r\n      throw new Error('Ingen respons frn OpenAI');\r\n    }\r\n\r\n    return JSON.parse(result);\r\n  } catch (error) {\r\n    console.error('[OpenAI] Schema generation error:', error);\r\n    throw error;\r\n  }\r\n}\r\n","// fetch_url - MCP verktyg fr att hmta HTML frn en URL\n// Anvnds fr on-page SEO analys\n\nimport axios, { AxiosError } from 'axios';\n\nexport interface FetchUrlOptions {\n  url: string;\n  timeout?: number; // i millisekunder\n  userAgent?: string;\n}\n\nexport interface FetchUrlResult {\n  success: boolean;\n  url: string;\n  html?: string;\n  statusCode?: number;\n  error?: string;\n  redirectUrl?: string;\n  contentType?: string;\n}\n\n/**\n * Hmtar HTML innehll frn en URL\n * @param options - URL och optionella instllningar\n * @returns Resultat med HTML eller felmeddelande\n */\nexport async function fetchUrl(options: FetchUrlOptions): Promise<FetchUrlResult> {\n  const {\n    url,\n    timeout = 30000,\n    userAgent = 'SEO-Agent/1.0 (+https://yoursite.com/bot)',\n  } = options;\n\n  try {\n    // Validera URL format\n    const urlObj = new URL(url);\n    if (!['http:', 'https:'].includes(urlObj.protocol)) {\n      return {\n        success: false,\n        url,\n        error: 'Only HTTP and HTTPS protocols are supported',\n      };\n    }\n\n    // Gr HTTP request\n    const response = await axios.get(url, {\n      timeout,\n      headers: {\n        'User-Agent': userAgent,\n        'Accept': 'text/html,application/xhtml+xml',\n      },\n      maxRedirects: 5,\n      validateStatus: (status) => status < 500, // Acceptera alla statuskoder under 500\n    });\n\n    // Kontrollera om det r HTML\n    const contentType = response.headers['content-type'] || '';\n    const isHtml = contentType.includes('text/html') || contentType.includes('application/xhtml');\n\n    if (!isHtml) {\n      return {\n        success: false,\n        url,\n        statusCode: response.status,\n        contentType,\n        error: `Content-Type is not HTML: ${contentType}`,\n      };\n    }\n\n    // Success!\n    return {\n      success: true,\n      url,\n      html: response.data,\n      statusCode: response.status,\n      contentType,\n      redirectUrl: response.request?.res?.responseUrl || url,\n    };\n\n  } catch (error) {\n    if (axios.isAxiosError(error)) {\n      const axiosError = error as AxiosError;\n\n      if (axiosError.code === 'ECONNABORTED') {\n        return {\n          success: false,\n          url,\n          error: `Request timeout after ${timeout}ms`,\n        };\n      }\n\n      if (axiosError.response) {\n        return {\n          success: false,\n          url,\n          statusCode: axiosError.response.status,\n          error: `HTTP ${axiosError.response.status}: ${axiosError.response.statusText}`,\n        };\n      }\n\n      if (axiosError.request) {\n        return {\n          success: false,\n          url,\n          error: 'No response received from server',\n        };\n      }\n    }\n\n    return {\n      success: false,\n      url,\n      error: error instanceof Error ? error.message : 'Unknown error occurred',\n    };\n  }\n}\n\n/**\n * Batch fetch flera URLs med rate limiting\n * @param urls - Array av URLs att hmta\n * @param concurrency - Max antal samtidiga requests\n * @returns Array av resultat\n */\nexport async function fetchUrlBatch(\n  urls: string[],\n  concurrency = 3\n): Promise<FetchUrlResult[]> {\n  const results: FetchUrlResult[] = [];\n\n  for (let i = 0; i < urls.length; i += concurrency) {\n    const batch = urls.slice(i, i + concurrency);\n    const batchResults = await Promise.all(\n      batch.map(url => fetchUrl({ url }))\n    );\n    results.push(...batchResults);\n\n    // Liten delay mellan batches fr att inte verbelasta\n    if (i + concurrency < urls.length) {\n      await new Promise(resolve => setTimeout(resolve, 1000));\n    }\n  }\n\n  return results;\n}\n","// read_sitemap - MCP verktyg fr att lsa och parsa sitemap.xml\n// Stdjer bde vanliga sitemaps och sitemap index\n\nimport { XMLParser } from 'fast-xml-parser';\nimport { fetchUrl } from './fetch-url';\n\nexport interface SitemapUrl {\n  loc: string;\n  lastmod?: string;\n  changefreq?: string;\n  priority?: number;\n}\n\nexport interface ReadSitemapResult {\n  success: boolean;\n  urls: SitemapUrl[];\n  totalUrls: number;\n  error?: string;\n  isSitemapIndex?: boolean;\n  childSitemaps?: string[];\n}\n\n/**\n * Lser och parsar en sitemap.xml eller sitemap index\n * @param sitemapUrl - URL till sitemap.xml\n * @returns Parsed sitemap med alla URLs\n */\nexport async function readSitemap(sitemapUrl: string): Promise<ReadSitemapResult> {\n  try {\n    // Hmta sitemap innehll\n    const fetchResult = await fetchUrl({ url: sitemapUrl });\n\n    if (!fetchResult.success || !fetchResult.html) {\n      return {\n        success: false,\n        urls: [],\n        totalUrls: 0,\n        error: fetchResult.error || 'Failed to fetch sitemap',\n      };\n    }\n\n    // Parsa XML\n    const parser = new XMLParser({\n      ignoreAttributes: false,\n      attributeNamePrefix: '@_',\n    });\n\n    const parsed = parser.parse(fetchResult.html);\n\n    // Kolla om det r en sitemap index\n    if (parsed.sitemapindex) {\n      return await parseSitemapIndex(parsed.sitemapindex, sitemapUrl);\n    }\n\n    // Vanlig sitemap\n    if (parsed.urlset) {\n      return parseSitemapUrlset(parsed.urlset);\n    }\n\n    return {\n      success: false,\n      urls: [],\n      totalUrls: 0,\n      error: 'Invalid sitemap format: missing urlset or sitemapindex',\n    };\n\n  } catch (error) {\n    return {\n      success: false,\n      urls: [],\n      totalUrls: 0,\n      error: error instanceof Error ? error.message : 'Unknown error parsing sitemap',\n    };\n  }\n}\n\n/**\n * Parsar en vanlig sitemap urlset\n */\nfunction parseSitemapUrlset(urlset: any): ReadSitemapResult {\n  const urls: SitemapUrl[] = [];\n\n  // Normalisera till array (kan vara single object)\n  const urlEntries = Array.isArray(urlset.url) ? urlset.url : [urlset.url];\n\n  for (const entry of urlEntries) {\n    if (!entry || !entry.loc) continue;\n\n    urls.push({\n      loc: entry.loc,\n      lastmod: entry.lastmod,\n      changefreq: entry.changefreq,\n      priority: entry.priority ? parseFloat(entry.priority) : undefined,\n    });\n  }\n\n  return {\n    success: true,\n    urls,\n    totalUrls: urls.length,\n    isSitemapIndex: false,\n  };\n}\n\n/**\n * Parsar en sitemap index och hmtar alla child sitemaps\n */\nasync function parseSitemapIndex(\n  sitemapindex: any,\n  baseUrl: string\n): Promise<ReadSitemapResult> {\n  const childSitemaps: string[] = [];\n  const allUrls: SitemapUrl[] = [];\n\n  // Normalisera till array\n  const sitemapEntries = Array.isArray(sitemapindex.sitemap)\n    ? sitemapindex.sitemap\n    : [sitemapindex.sitemap];\n\n  // Samla alla child sitemap URLs\n  for (const entry of sitemapEntries) {\n    if (entry && entry.loc) {\n      childSitemaps.push(entry.loc);\n    }\n  }\n\n  // Hmta och parsa varje child sitemap (max 10 fr att inte verbelasta)\n  const sitemapsToFetch = childSitemaps.slice(0, 10);\n\n  for (const childUrl of sitemapsToFetch) {\n    try {\n      const result = await readSitemap(childUrl);\n      if (result.success) {\n        allUrls.push(...result.urls);\n      }\n      // Liten delay mellan requests\n      await new Promise(resolve => setTimeout(resolve, 500));\n    } catch (error) {\n      console.error(`Error fetching child sitemap ${childUrl}:`, error);\n    }\n  }\n\n  return {\n    success: true,\n    urls: allUrls,\n    totalUrls: allUrls.length,\n    isSitemapIndex: true,\n    childSitemaps,\n  };\n}\n\n/**\n * Lser robots.txt och hittar sitemap URLs\n * @param domain - Domain URL (e.g. https://example.com)\n * @returns Array av sitemap URLs frn robots.txt\n */\nexport async function findSitemapsInRobotsTxt(domain: string): Promise<string[]> {\n  try {\n    const robotsUrl = new URL('/robots.txt', domain).toString();\n    const fetchResult = await fetchUrl({ url: robotsUrl });\n\n    if (!fetchResult.success || !fetchResult.html) {\n      return [];\n    }\n\n    const sitemaps: string[] = [];\n    const lines = fetchResult.html.split('\\n');\n\n    for (const line of lines) {\n      const trimmed = line.trim();\n      if (trimmed.toLowerCase().startsWith('sitemap:')) {\n        const sitemapUrl = trimmed.substring(8).trim();\n        if (sitemapUrl) {\n          sitemaps.push(sitemapUrl);\n        }\n      }\n    }\n\n    return sitemaps;\n\n  } catch (error) {\n    console.error('Error reading robots.txt:', error);\n    return [];\n  }\n}\n\n/**\n * Auto-discover sitemap fr en domain\n * Frsker hitta sitemap via robots.txt eller vanliga platser\n */\nexport async function discoverSitemap(domain: string): Promise<ReadSitemapResult> {\n  // Frsk hitta via robots.txt frst\n  const robotsSitemaps = await findSitemapsInRobotsTxt(domain);\n\n  if (robotsSitemaps.length > 0) {\n    return await readSitemap(robotsSitemaps[0]);\n  }\n\n  // Frsk vanliga platser\n  const commonPaths = [\n    '/sitemap.xml',\n    '/sitemap_index.xml',\n    '/sitemap-index.xml',\n    '/sitemap1.xml',\n  ];\n\n  for (const path of commonPaths) {\n    try {\n      const sitemapUrl = new URL(path, domain).toString();\n      const result = await readSitemap(sitemapUrl);\n\n      if (result.success && result.totalUrls > 0) {\n        return result;\n      }\n    } catch (error) {\n      continue;\n    }\n  }\n\n  return {\n    success: false,\n    urls: [],\n    totalUrls: 0,\n    error: 'Could not discover sitemap for domain',\n  };\n}\n","// psi_audit - MCP verktyg fr PageSpeed Insights API\n// Hmtar Lighthouse score och Core Web Vitals\n\nimport axios from 'axios';\n\nexport interface CoreWebVitals {\n  lcp: number; // Largest Contentful Paint (sekunder)\n  cls: number; // Cumulative Layout Shift\n  inp: number; // Interaction to Next Paint (millisekunder)\n  fcp?: number; // First Contentful Paint (sekunder)\n  ttfb?: number; // Time to First Byte (millisekunder)\n}\n\nexport interface LighthouseMetrics {\n  performance: number; // 0-100\n  accessibility?: number;\n  bestPractices?: number;\n  seo?: number;\n}\n\nexport interface PSIIssue {\n  title: string;\n  description: string;\n  score?: number;\n  displayValue?: string;\n  impact?: 'low' | 'medium' | 'high';\n}\n\nexport interface PSIAuditResult {\n  success: boolean;\n  url: string;\n  vitals?: CoreWebVitals;\n  lighthouse?: LighthouseMetrics;\n  issues: PSIIssue[];\n  rawData?: any; // Full PSI response\n  error?: string;\n  requestId?: string;\n}\n\n/**\n * Kr PageSpeed Insights audit p en URL\n * @param url - URL att analysera\n * @param apiKey - Google PageSpeed Insights API key\n * @param strategy - 'mobile' eller 'desktop'\n * @returns PSI audit resultat\n */\nexport async function psiAudit(\n  url: string,\n  apiKey: string,\n  strategy: 'mobile' | 'desktop' = 'mobile'\n): Promise<PSIAuditResult> {\n  try {\n    // Bygg API URL\n    const apiUrl = new URL('https://www.googleapis.com/pagespeedonline/v5/runPagespeed');\n    apiUrl.searchParams.set('url', url);\n    apiUrl.searchParams.set('key', apiKey);\n    apiUrl.searchParams.set('strategy', strategy);\n    apiUrl.searchParams.set('category', 'performance');\n    apiUrl.searchParams.set('category', 'accessibility');\n    apiUrl.searchParams.set('category', 'best-practices');\n    apiUrl.searchParams.set('category', 'seo');\n\n    // Gr request med lngre timeout (PSI kan ta tid)\n    const response = await axios.get(apiUrl.toString(), {\n      timeout: 60000, // 60 sekunder\n    });\n\n    const data = response.data;\n\n    // Extrahera Core Web Vitals\n    const vitals = extractCoreWebVitals(data);\n\n    // Extrahera Lighthouse scores\n    const lighthouse = extractLighthouseScores(data);\n\n    // Extrahera viktiga issues\n    const issues = extractIssues(data);\n\n    return {\n      success: true,\n      url,\n      vitals,\n      lighthouse,\n      issues,\n      rawData: data,\n      requestId: data.id,\n    };\n\n  } catch (error) {\n    if (axios.isAxiosError(error)) {\n      if (error.response) {\n        return {\n          success: false,\n          url,\n          issues: [],\n          error: `PSI API error: ${error.response.status} - ${JSON.stringify(error.response.data)}`,\n        };\n      }\n\n      if (error.code === 'ECONNABORTED') {\n        return {\n          success: false,\n          url,\n          issues: [],\n          error: 'PSI API timeout after 60 seconds',\n        };\n      }\n    }\n\n    return {\n      success: false,\n      url,\n      issues: [],\n      error: error instanceof Error ? error.message : 'Unknown PSI error',\n    };\n  }\n}\n\n/**\n * Extraherar Core Web Vitals frn PSI response\n */\nfunction extractCoreWebVitals(data: any): CoreWebVitals | undefined {\n  try {\n    const metrics = data.loadingExperience?.metrics;\n    const labData = data.lighthouseResult?.audits;\n\n    if (!metrics && !labData) return undefined;\n\n    // Field data (real user data) prioriteras\n    const lcp = metrics?.LARGEST_CONTENTFUL_PAINT_MS?.percentile\n      ? metrics.LARGEST_CONTENTFUL_PAINT_MS.percentile / 1000\n      : labData?.['largest-contentful-paint']?.numericValue\n      ? labData['largest-contentful-paint'].numericValue / 1000\n      : 0;\n\n    const cls = metrics?.CUMULATIVE_LAYOUT_SHIFT_SCORE?.percentile\n      ? metrics.CUMULATIVE_LAYOUT_SHIFT_SCORE.percentile / 100\n      : labData?.['cumulative-layout-shift']?.numericValue || 0;\n\n    const inp = metrics?.INTERACTION_TO_NEXT_PAINT?.percentile\n      ? metrics.INTERACTION_TO_NEXT_PAINT.percentile\n      : labData?.['interaction-to-next-paint']?.numericValue || 0;\n\n    const fcp = labData?.['first-contentful-paint']?.numericValue\n      ? labData['first-contentful-paint'].numericValue / 1000\n      : undefined;\n\n    const ttfb = labData?.['server-response-time']?.numericValue || undefined;\n\n    return {\n      lcp: parseFloat(lcp.toFixed(2)),\n      cls: parseFloat(cls.toFixed(4)),\n      inp: parseFloat(inp.toFixed(2)),\n      fcp: fcp ? parseFloat(fcp.toFixed(2)) : undefined,\n      ttfb: ttfb ? parseFloat(ttfb.toFixed(2)) : undefined,\n    };\n  } catch (error) {\n    console.error('Error extracting Core Web Vitals:', error);\n    return undefined;\n  }\n}\n\n/**\n * Extraherar Lighthouse scores frn PSI response\n */\nfunction extractLighthouseScores(data: any): LighthouseMetrics | undefined {\n  try {\n    const categories = data.lighthouseResult?.categories;\n    if (!categories) return undefined;\n\n    return {\n      performance: Math.round((categories.performance?.score || 0) * 100),\n      accessibility: categories.accessibility\n        ? Math.round(categories.accessibility.score * 100)\n        : undefined,\n      bestPractices: categories['best-practices']\n        ? Math.round(categories['best-practices'].score * 100)\n        : undefined,\n      seo: categories.seo ? Math.round(categories.seo.score * 100) : undefined,\n    };\n  } catch (error) {\n    console.error('Error extracting Lighthouse scores:', error);\n    return undefined;\n  }\n}\n\n/**\n * Extraherar viktiga issues frn Lighthouse audits\n */\nfunction extractIssues(data: any): PSIIssue[] {\n  const issues: PSIIssue[] = [];\n\n  try {\n    const audits = data.lighthouseResult?.audits;\n    if (!audits) return issues;\n\n    // Viktiga audits att kolla\n    const importantAudits = [\n      'largest-contentful-paint',\n      'cumulative-layout-shift',\n      'interaction-to-next-paint',\n      'first-contentful-paint',\n      'speed-index',\n      'total-blocking-time',\n      'server-response-time',\n      'render-blocking-resources',\n      'unminified-css',\n      'unminified-javascript',\n      'unused-css-rules',\n      'unused-javascript',\n      'modern-image-formats',\n      'uses-optimized-images',\n      'uses-text-compression',\n      'uses-responsive-images',\n    ];\n\n    for (const auditKey of importantAudits) {\n      const audit = audits[auditKey];\n      if (!audit) continue;\n\n      // Bara rapportera om score r lg (under 0.9)\n      if (audit.score !== null && audit.score < 0.9) {\n        issues.push({\n          title: audit.title || auditKey,\n          description: audit.description || '',\n          score: audit.score,\n          displayValue: audit.displayValue,\n          impact: determineImpact(audit.score),\n        });\n      }\n    }\n\n    return issues;\n  } catch (error) {\n    console.error('Error extracting issues:', error);\n    return issues;\n  }\n}\n\n/**\n * Bestmmer impact level baserat p score\n */\nfunction determineImpact(score: number): 'low' | 'medium' | 'high' {\n  if (score >= 0.5) return 'low';\n  if (score >= 0.3) return 'medium';\n  return 'high';\n}\n\n/**\n * Batch PSI audit med rate limiting och retry\n */\nexport async function psiAuditBatch(\n  urls: string[],\n  apiKey: string,\n  strategy: 'mobile' | 'desktop' = 'mobile',\n  delayMs = 2000 // Delay mellan requests fr att respektera rate limits\n): Promise<PSIAuditResult[]> {\n  const results: PSIAuditResult[] = [];\n\n  for (const url of urls) {\n    try {\n      const result = await psiAudit(url, apiKey, strategy);\n      results.push(result);\n\n      // Delay mellan requests\n      if (urls.indexOf(url) < urls.length - 1) {\n        await new Promise(resolve => setTimeout(resolve, delayMs));\n      }\n\n      // Exponential backoff vid fel\n      if (!result.success && result.error?.includes('429')) {\n        console.log('Rate limit hit, waiting 10 seconds...');\n        await new Promise(resolve => setTimeout(resolve, 10000));\n      }\n\n    } catch (error) {\n      results.push({\n        success: false,\n        url,\n        issues: [],\n        error: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  }\n\n  return results;\n}\n","// gsc_top_queries - MCP verktyg fr Google Search Console API\n// Hmtar top queries och performance data\n\nimport axios from 'axios';\n\nexport interface GSCQuery {\n  query: string;\n  clicks: number;\n  impressions: number;\n  ctr: number;\n  position: number;\n}\n\nexport interface GSCPageData {\n  page: string;\n  clicks: number;\n  impressions: number;\n  ctr: number;\n  position: number;\n  topQueries?: GSCQuery[];\n}\n\nexport interface GSCTopQueriesResult {\n  success: boolean;\n  siteUrl: string;\n  data: GSCPageData[];\n  totalRows: number;\n  startDate: string;\n  endDate: string;\n  error?: string;\n}\n\n/**\n * Hmtar top queries frn Google Search Console\n * @param siteUrl - Verified site URL i GSC (e.g. 'https://example.com')\n * @param accessToken - OAuth2 access token\n * @param startDate - Start datum (YYYY-MM-DD)\n * @param endDate - Slut datum (YYYY-MM-DD)\n * @param rowLimit - Max antal rader att hmta\n * @returns GSC query data\n */\nexport async function gscTopQueries(\n  siteUrl: string,\n  accessToken: string,\n  startDate: string,\n  endDate: string,\n  rowLimit = 1000\n): Promise<GSCTopQueriesResult> {\n  try {\n    // Bygg API request\n    const apiUrl = `https://searchconsole.googleapis.com/v1/sites/${encodeURIComponent(\n      siteUrl\n    )}/searchAnalytics/query`;\n\n    const requestBody = {\n      startDate,\n      endDate,\n      dimensions: ['page', 'query'],\n      rowLimit,\n      startRow: 0,\n    };\n\n    // Gr request\n    const response = await axios.post(apiUrl, requestBody, {\n      headers: {\n        Authorization: `Bearer ${accessToken}`,\n        'Content-Type': 'application/json',\n      },\n      timeout: 30000,\n    });\n\n    // Processera resultat\n    const rows = response.data.rows || [];\n    const pageMap = new Map<string, GSCPageData>();\n\n    for (const row of rows) {\n      const [page, query] = row.keys;\n      const { clicks, impressions, ctr, position } = row;\n\n      if (!pageMap.has(page)) {\n        pageMap.set(page, {\n          page,\n          clicks: 0,\n          impressions: 0,\n          ctr: 0,\n          position: 0,\n          topQueries: [],\n        });\n      }\n\n      const pageData = pageMap.get(page)!;\n      pageData.clicks += clicks;\n      pageData.impressions += impressions;\n\n      pageData.topQueries!.push({\n        query,\n        clicks,\n        impressions,\n        ctr,\n        position,\n      });\n    }\n\n    // Berkna aggregerade vrden och sortera queries\n    const data: GSCPageData[] = Array.from(pageMap.values()).map(pageData => {\n      // Sortera queries efter clicks\n      pageData.topQueries!.sort((a, b) => b.clicks - a.clicks);\n\n      // Berkna genomsnittlig CTR och position\n      const totalQueries = pageData.topQueries!.length;\n      pageData.ctr = pageData.clicks / pageData.impressions;\n      pageData.position =\n        pageData.topQueries!.reduce((sum, q) => sum + q.position, 0) / totalQueries;\n\n      return pageData;\n    });\n\n    // Sortera sidor efter clicks\n    data.sort((a, b) => b.clicks - a.clicks);\n\n    return {\n      success: true,\n      siteUrl,\n      data,\n      totalRows: data.length,\n      startDate,\n      endDate,\n    };\n\n  } catch (error) {\n    if (axios.isAxiosError(error)) {\n      if (error.response) {\n        return {\n          success: false,\n          siteUrl,\n          data: [],\n          totalRows: 0,\n          startDate,\n          endDate,\n          error: `GSC API error: ${error.response.status} - ${JSON.stringify(\n            error.response.data\n          )}`,\n        };\n      }\n    }\n\n    return {\n      success: false,\n      siteUrl,\n      data: [],\n      totalRows: 0,\n      startDate,\n      endDate,\n      error: error instanceof Error ? error.message : 'Unknown GSC error',\n    };\n  }\n}\n\n/**\n * Hittar sidor med lg CTR nra topp 10\n * @param gscData - GSC data frn gscTopQueries\n * @param minPosition - Min position fr att inkluderas (default 15)\n * @param maxPosition - Max position fr att inkluderas (default 1)\n * @param ctrThreshold - CTR under detta vrde flaggas (default 0.05 = 5%)\n * @returns Filtrerade sidor med lg CTR\n */\nexport function findLowCtrPages(\n  gscData: GSCPageData[],\n  minPosition = 1,\n  maxPosition = 15,\n  ctrThreshold = 0.05\n): GSCPageData[] {\n  return gscData.filter(\n    page =>\n      page.position >= minPosition &&\n      page.position <= maxPosition &&\n      page.ctr < ctrThreshold &&\n      page.impressions > 10 // Minst 10 impressions fr att vara relevant\n  );\n}\n\n/**\n * OAuth2 token refresh\n * @param refreshToken - Refresh token frn OAuth2 flow\n * @param clientId - Google OAuth2 client ID\n * @param clientSecret - Google OAuth2 client secret\n * @returns Ny access token\n */\nexport async function refreshGSCToken(\n  refreshToken: string,\n  clientId: string,\n  clientSecret: string\n): Promise<string> {\n  try {\n    const response = await axios.post('https://oauth2.googleapis.com/token', {\n      client_id: clientId,\n      client_secret: clientSecret,\n      refresh_token: refreshToken,\n      grant_type: 'refresh_token',\n    });\n\n    return response.data.access_token;\n  } catch (error) {\n    throw new Error(\n      `Failed to refresh GSC token: ${\n        error instanceof Error ? error.message : 'Unknown error'\n      }`\n    );\n  }\n}\n\n/**\n * Hmtar GSC data fr en specifik sida/URL\n * @param siteUrl - Verified site URL i GSC\n * @param pageUrl - Specifik page URL att hmta data fr\n * @param accessToken - OAuth2 access token\n * @param startDate - Start datum\n * @param endDate - Slut datum\n * @returns GSC data fr sidan\n */\nexport async function gscPageData(\n  siteUrl: string,\n  pageUrl: string,\n  accessToken: string,\n  startDate: string,\n  endDate: string\n): Promise<GSCPageData | null> {\n  try {\n    const apiUrl = `https://searchconsole.googleapis.com/v1/sites/${encodeURIComponent(\n      siteUrl\n    )}/searchAnalytics/query`;\n\n    const requestBody = {\n      startDate,\n      endDate,\n      dimensions: ['query'],\n      dimensionFilterGroups: [\n        {\n          filters: [\n            {\n              dimension: 'page',\n              expression: pageUrl,\n              operator: 'equals',\n            },\n          ],\n        },\n      ],\n      rowLimit: 100,\n    };\n\n    const response = await axios.post(apiUrl, requestBody, {\n      headers: {\n        Authorization: `Bearer ${accessToken}`,\n        'Content-Type': 'application/json',\n      },\n      timeout: 30000,\n    });\n\n    const rows = response.data.rows || [];\n\n    if (rows.length === 0) {\n      return null;\n    }\n\n    const topQueries: GSCQuery[] = rows.map((row: any) => ({\n      query: row.keys[0],\n      clicks: row.clicks,\n      impressions: row.impressions,\n      ctr: row.ctr,\n      position: row.position,\n    }));\n\n    // Berkna totaler\n    const totalClicks = topQueries.reduce((sum, q) => sum + q.clicks, 0);\n    const totalImpressions = topQueries.reduce((sum, q) => sum + q.impressions, 0);\n    const avgPosition =\n      topQueries.reduce((sum, q) => sum + q.position, 0) / topQueries.length;\n\n    return {\n      page: pageUrl,\n      clicks: totalClicks,\n      impressions: totalImpressions,\n      ctr: totalClicks / totalImpressions,\n      position: avgPosition,\n      topQueries,\n    };\n\n  } catch (error) {\n    console.error('Error fetching GSC page data:', error);\n    return null;\n  }\n}\n","// On-Page SEO Analysis\n// Analyserar HTML fr SEO-faktorer: title, meta, h1, canonical, images\n\nimport * as cheerio from 'cheerio';\n\nexport interface OnPageIssue {\n  type: 'title' | 'meta-description' | 'h1' | 'canonical' | 'images' | 'other';\n  severity: 'low' | 'medium' | 'high';\n  message: string;\n  current?: string;\n  recommendation?: string;\n}\n\nexport interface OnPageResult {\n  title?: string;\n  titleLength: number;\n  metaDescription?: string;\n  metaDescriptionLength: number;\n  h1Tags: string[];\n  h1Count: number;\n  canonical?: string;\n  totalImages: number;\n  imagesWithAlt: number;\n  imagesWithoutAlt: number;\n  altCoverage: number; // procent\n  issues: OnPageIssue[];\n  score: number; // 0-100\n}\n\n/**\n * Analyserar HTML fr on-page SEO faktorer\n * @param html - HTML innehll att analysera\n * @param url - URL fr canonical check\n * @returns On-page analys resultat\n */\nexport function analyzeOnPage(html: string, url: string): OnPageResult {\n  const $ = cheerio.load(html);\n  const issues: OnPageIssue[] = [];\n\n  // Analysera Title\n  const title = $('title').first().text().trim();\n  const titleLength = title.length;\n\n  if (!title) {\n    issues.push({\n      type: 'title',\n      severity: 'high',\n      message: 'Missing title tag',\n      recommendation: 'Add a descriptive title tag (50-60 characters)',\n    });\n  } else if (titleLength < 30) {\n    issues.push({\n      type: 'title',\n      severity: 'medium',\n      message: 'Title too short',\n      current: `${titleLength} characters`,\n      recommendation: 'Title should be 50-60 characters for optimal display',\n    });\n  } else if (titleLength > 70) {\n    issues.push({\n      type: 'title',\n      severity: 'medium',\n      message: 'Title too long',\n      current: `${titleLength} characters`,\n      recommendation: 'Title should be 50-60 characters to avoid truncation',\n    });\n  }\n\n  // Analysera Meta Description\n  const metaDescription = $('meta[name=\"description\"]').attr('content')?.trim() || '';\n  const metaDescriptionLength = metaDescription.length;\n\n  if (!metaDescription) {\n    issues.push({\n      type: 'meta-description',\n      severity: 'high',\n      message: 'Missing meta description',\n      recommendation: 'Add a compelling meta description (140-160 characters)',\n    });\n  } else if (metaDescriptionLength < 120) {\n    issues.push({\n      type: 'meta-description',\n      severity: 'medium',\n      message: 'Meta description too short',\n      current: `${metaDescriptionLength} characters`,\n      recommendation: 'Meta description should be 140-160 characters',\n    });\n  } else if (metaDescriptionLength > 170) {\n    issues.push({\n      type: 'meta-description',\n      severity: 'low',\n      message: 'Meta description too long',\n      current: `${metaDescriptionLength} characters`,\n      recommendation: 'Meta description should be 140-160 characters to avoid truncation',\n    });\n  }\n\n  // Analysera H1\n  const h1Tags: string[] = [];\n  $('h1').each((_, el) => {\n    const text = $(el).text().trim();\n    if (text) h1Tags.push(text);\n  });\n\n  const h1Count = h1Tags.length;\n\n  if (h1Count === 0) {\n    issues.push({\n      type: 'h1',\n      severity: 'high',\n      message: 'Missing H1 tag',\n      recommendation: 'Add exactly one H1 tag that matches page intent',\n    });\n  } else if (h1Count > 1) {\n    issues.push({\n      type: 'h1',\n      severity: 'medium',\n      message: 'Multiple H1 tags found',\n      current: `${h1Count} H1 tags`,\n      recommendation: 'Use only one H1 tag per page',\n    });\n  }\n\n  // Analysera Canonical\n  const canonical = $('link[rel=\"canonical\"]').attr('href')?.trim();\n\n  if (!canonical) {\n    issues.push({\n      type: 'canonical',\n      severity: 'medium',\n      message: 'Missing canonical tag',\n      recommendation: 'Add a canonical tag to prevent duplicate content issues',\n    });\n  }\n\n  // Analysera Images och Alt text\n  let totalImages = 0;\n  let imagesWithAlt = 0;\n  let imagesWithoutAlt = 0;\n\n  $('img').each((_, el) => {\n    totalImages++;\n    const alt = $(el).attr('alt');\n\n    if (alt !== undefined && alt.trim() !== '') {\n      imagesWithAlt++;\n    } else {\n      imagesWithoutAlt++;\n    }\n  });\n\n  const altCoverage = totalImages > 0 ? (imagesWithAlt / totalImages) * 100 : 100;\n\n  if (altCoverage < 80 && totalImages > 0) {\n    issues.push({\n      type: 'images',\n      severity: altCoverage < 50 ? 'high' : 'medium',\n      message: 'Low alt text coverage',\n      current: `${altCoverage.toFixed(0)}% coverage (${imagesWithAlt}/${totalImages} images)`,\n      recommendation: 'Add descriptive alt text to at least 80% of images',\n    });\n  }\n\n  // Berkna score\n  const score = calculateOnPageScore({\n    titleLength,\n    metaDescriptionLength,\n    h1Count,\n    hasCanonical: !!canonical,\n    altCoverage,\n  });\n\n  return {\n    title,\n    titleLength,\n    metaDescription,\n    metaDescriptionLength,\n    h1Tags,\n    h1Count,\n    canonical,\n    totalImages,\n    imagesWithAlt,\n    imagesWithoutAlt,\n    altCoverage: parseFloat(altCoverage.toFixed(2)),\n    issues,\n    score,\n  };\n}\n\n/**\n * Berknar on-page score (0-100)\n */\nfunction calculateOnPageScore(params: {\n  titleLength: number;\n  metaDescriptionLength: number;\n  h1Count: number;\n  hasCanonical: boolean;\n  altCoverage: number;\n}): number {\n  let score = 100;\n\n  // Title scoring (25 pong)\n  if (params.titleLength === 0) {\n    score -= 25;\n  } else if (params.titleLength < 30 || params.titleLength > 70) {\n    score -= 10;\n  } else if (params.titleLength >= 50 && params.titleLength <= 60) {\n    // Perfect length\n    score += 0;\n  } else {\n    score -= 5;\n  }\n\n  // Meta description scoring (20 pong)\n  if (params.metaDescriptionLength === 0) {\n    score -= 20;\n  } else if (\n    params.metaDescriptionLength < 120 ||\n    params.metaDescriptionLength > 170\n  ) {\n    score -= 10;\n  } else if (\n    params.metaDescriptionLength >= 140 &&\n    params.metaDescriptionLength <= 160\n  ) {\n    // Perfect length\n    score += 0;\n  } else {\n    score -= 5;\n  }\n\n  // H1 scoring (20 pong)\n  if (params.h1Count === 0) {\n    score -= 20;\n  } else if (params.h1Count === 1) {\n    // Perfect\n    score += 0;\n  } else {\n    score -= 10;\n  }\n\n  // Canonical scoring (15 pong)\n  if (!params.hasCanonical) {\n    score -= 15;\n  }\n\n  // Alt coverage scoring (20 pong)\n  if (params.altCoverage < 50) {\n    score -= 20;\n  } else if (params.altCoverage < 80) {\n    score -= 10;\n  }\n\n  return Math.max(0, Math.min(100, score));\n}\n\n/**\n * Genererar actionable frslag frn on-page issues\n */\nexport function generateOnPageSuggestions(\n  result: OnPageResult,\n  url: string\n): Array<{\n  action: string;\n  impact: 'low' | 'medium' | 'high';\n}> {\n  const suggestions: Array<{\n    action: string;\n    impact: 'low' | 'medium' | 'high';\n  }> = [];\n\n  for (const issue of result.issues) {\n    suggestions.push({\n      action: `${issue.message}${\n        issue.recommendation ? `: ${issue.recommendation}` : ''\n      }`,\n      impact: issue.severity,\n    });\n  }\n\n  return suggestions;\n}\n","// SEO Scoring System\n// Kombinerar on-page, Core Web Vitals och GSC data fr total score\n\nimport type { OnPageResult } from './on-page-analysis';\nimport type { CoreWebVitals } from '../mcp/psi-audit';\n\nexport interface ScoringWeights {\n  onPage: number; // 0-1, default 0.4\n  vitals: number; // 0-1, default 0.5\n  gsc: number; // 0-1, default 0.1\n}\n\nexport interface GSCMetrics {\n  ctr: number;\n  position: number;\n  impressions: number;\n}\n\nexport interface ScoreBreakdown {\n  total: number; // 0-100\n  onPageScore: number;\n  vitalsScore: number;\n  gscScore: number;\n  issues: Array<{\n    category: 'on-page' | 'vitals' | 'gsc';\n    severity: 'low' | 'medium' | 'high';\n    message: string;\n  }>;\n}\n\nconst DEFAULT_WEIGHTS: ScoringWeights = {\n  onPage: 0.4,\n  vitals: 0.5,\n  gsc: 0.1,\n};\n\n/**\n * Berknar total SEO score\n * @param onPageResult - On-page analys resultat\n * @param vitals - Core Web Vitals frn PSI\n * @param gscMetrics - Google Search Console metrics (optional)\n * @param weights - Viktning av olika faktorer\n * @returns Score breakdown\n */\nexport function calculateSEOScore(\n  onPageResult: OnPageResult,\n  vitals?: CoreWebVitals,\n  gscMetrics?: GSCMetrics,\n  weights: ScoringWeights = DEFAULT_WEIGHTS\n): ScoreBreakdown {\n  const issues: ScoreBreakdown['issues'] = [];\n\n  // On-page score (redan berknad)\n  const onPageScore = onPageResult.score;\n\n  // Lgg till on-page issues\n  for (const issue of onPageResult.issues) {\n    issues.push({\n      category: 'on-page',\n      severity: issue.severity,\n      message: issue.message,\n    });\n  }\n\n  // Core Web Vitals score\n  let vitalsScore = 100;\n\n  if (vitals) {\n    // LCP scoring\n    if (vitals.lcp > 4.0) {\n      vitalsScore -= 30;\n      issues.push({\n        category: 'vitals',\n        severity: 'high',\n        message: `LCP is ${vitals.lcp.toFixed(2)}s (should be under 2.5s)`,\n      });\n    } else if (vitals.lcp > 2.5) {\n      vitalsScore -= 15;\n      issues.push({\n        category: 'vitals',\n        severity: 'medium',\n        message: `LCP is ${vitals.lcp.toFixed(2)}s (should be under 2.5s)`,\n      });\n    }\n\n    // CLS scoring\n    if (vitals.cls > 0.25) {\n      vitalsScore -= 30;\n      issues.push({\n        category: 'vitals',\n        severity: 'high',\n        message: `CLS is ${vitals.cls.toFixed(4)} (should be under 0.1)`,\n      });\n    } else if (vitals.cls > 0.1) {\n      vitalsScore -= 15;\n      issues.push({\n        category: 'vitals',\n        severity: 'medium',\n        message: `CLS is ${vitals.cls.toFixed(4)} (should be under 0.1)`,\n      });\n    }\n\n    // INP scoring\n    if (vitals.inp > 500) {\n      vitalsScore -= 20;\n      issues.push({\n        category: 'vitals',\n        severity: 'high',\n        message: `INP is ${vitals.inp.toFixed(0)}ms (should be under 200ms)`,\n      });\n    } else if (vitals.inp > 200) {\n      vitalsScore -= 10;\n      issues.push({\n        category: 'vitals',\n        severity: 'medium',\n        message: `INP is ${vitals.inp.toFixed(0)}ms (should be under 200ms)`,\n      });\n    }\n\n    vitalsScore = Math.max(0, vitalsScore);\n  } else {\n    // Om vi inte har vitals data, anvnd neutral score\n    vitalsScore = 50;\n  }\n\n  // GSC score (baserat p CTR och position)\n  let gscScore = 100;\n\n  if (gscMetrics && gscMetrics.impressions > 10) {\n    // CTR scoring\n    const expectedCtr = calculateExpectedCtr(gscMetrics.position);\n    const ctrRatio = gscMetrics.ctr / expectedCtr;\n\n    if (ctrRatio < 0.5) {\n      gscScore -= 40;\n      issues.push({\n        category: 'gsc',\n        severity: 'high',\n        message: `CTR is ${(gscMetrics.ctr * 100).toFixed(2)}% (expected ~${(\n          expectedCtr * 100\n        ).toFixed(2)}% for position ${gscMetrics.position.toFixed(1)})`,\n      });\n    } else if (ctrRatio < 0.8) {\n      gscScore -= 20;\n      issues.push({\n        category: 'gsc',\n        severity: 'medium',\n        message: `CTR is ${(gscMetrics.ctr * 100).toFixed(2)}% (below expected for position ${gscMetrics.position.toFixed(1)})`,\n      });\n    }\n\n    // Position scoring (incentivize improvement to top 3)\n    if (gscMetrics.position > 10) {\n      gscScore -= 30;\n    } else if (gscMetrics.position > 5) {\n      gscScore -= 15;\n    } else if (gscMetrics.position > 3) {\n      gscScore -= 5;\n    }\n\n    gscScore = Math.max(0, gscScore);\n  } else {\n    // Om vi inte har GSC data, anvnd neutral score\n    gscScore = 50;\n  }\n\n  // Berkna weighted total score\n  const total = Math.round(\n    onPageScore * weights.onPage +\n      vitalsScore * weights.vitals +\n      gscScore * weights.gsc\n  );\n\n  return {\n    total,\n    onPageScore,\n    vitalsScore,\n    gscScore,\n    issues,\n  };\n}\n\n/**\n * Berknar frvntad CTR baserat p position\n * Data frn branschstudier (approximation)\n */\nfunction calculateExpectedCtr(position: number): number {\n  if (position <= 1) return 0.3;\n  if (position <= 2) return 0.15;\n  if (position <= 3) return 0.1;\n  if (position <= 5) return 0.06;\n  if (position <= 10) return 0.03;\n  return 0.01;\n}\n\n/**\n * Bestmmer prioritet baserat p score och trend\n * @param currentScore - Nuvarande score\n * @param previousScore - Tidigare score (optional)\n * @param vitals - Core Web Vitals\n * @param daysSinceLastCheck - Dagar sedan senaste check\n * @returns Priority weight (hgre = mer urgent)\n */\nexport function calculatePriority(\n  currentScore: number,\n  previousScore: number | null,\n  vitals: CoreWebVitals | undefined,\n  daysSinceLastCheck: number\n): number {\n  let priority = 0;\n\n  // Bas prioritet frn score (lgre score = hgre prio)\n  priority += (100 - currentScore) * 0.5;\n\n  // Trend prioritet (frsmring ger hgre prio)\n  if (previousScore !== null) {\n    const scoreDiff = currentScore - previousScore;\n    if (scoreDiff < -10) {\n      priority += 30; // Stor frsmring\n    } else if (scoreDiff < 0) {\n      priority += 15; // Mindre frsmring\n    } else if (scoreDiff > 10) {\n      priority -= 10; // Frbttring, minska prio\n    }\n  }\n\n  // Vitals prioritet (dliga vitals ger hgre prio)\n  if (vitals) {\n    if (vitals.lcp > 4.0) priority += 20;\n    if (vitals.cls > 0.25) priority += 20;\n    if (vitals.inp > 500) priority += 15;\n  }\n\n  // Tid sedan senaste check (ldre checks ger hgre prio)\n  if (daysSinceLastCheck > 7) {\n    priority += 10;\n  } else if (daysSinceLastCheck > 14) {\n    priority += 20;\n  }\n\n  return Math.max(0, priority);\n}\n\n/**\n * Flaggar sidor som behver omedelbar uppmrksamhet\n * @param score - Total score\n * @param vitals - Core Web Vitals\n * @param scoreDiff - Frndring i score sedan frra\n * @returns True om sidan ska flaggas\n */\nexport function shouldFlagPage(\n  score: number,\n  vitals: CoreWebVitals | undefined,\n  scoreDiff: number | null\n): boolean {\n  // Flagga om score faller mer n 10 pong\n  if (scoreDiff !== null && scoreDiff < -10) {\n    return true;\n  }\n\n  // Flagga om LCP ver 2.5s\n  if (vitals && vitals.lcp > 2.5) {\n    return true;\n  }\n\n  // Flagga om CLS ver 0.1\n  if (vitals && vitals.cls > 0.1) {\n    return true;\n  }\n\n  // Flagga om INP ver 200ms\n  if (vitals && vitals.inp > 200) {\n    return true;\n  }\n\n  // Flagga om total score under 40\n  if (score < 40) {\n    return true;\n  }\n\n  return false;\n}\n","// SEO Agent Core\n// Huvudlogik fr automatisk SEO-agent med prioritering och historik\n// Uppdaterad med OpenAI-integration fr AI-driven analys\n\nimport { fetchUrl } from '../mcp/fetch-url';\nimport { readSitemap, discoverSitemap } from '../mcp/read-sitemap';\nimport { psiAudit } from '../mcp/psi-audit';\nimport { gscTopQueries, gscPageData } from '../mcp/gsc-top-queries';\nimport { analyzeOnPage, generateOnPageSuggestions } from '../seo/on-page-analysis';\nimport { calculateSEOScore, calculatePriority, shouldFlagPage } from '../seo/scoring';\nimport { analyzePageWithAI } from '../ai/openai-client';\nimport { getPageAnalytics } from '../analytics/google-analytics';\nimport {\n  createRun,\n  updateRun,\n  upsertPage,\n  updatePageMetrics,\n  getAllPages,\n  createAudit,\n  getAuditsByUrl,\n  createSuggestion,\n  refreshMaterializedViews,\n} from '../db/operations';\n\nexport interface AgentConfig {\n  siteUrl: string;\n  sitemapUrl?: string; // Om tom, frsk auto-discover\n  psiApiKey: string;\n  gscAccessToken?: string; // Optional\n  gscSiteUrl?: string; // Verified site URL i GSC\n  gaPropertyId?: string; // Google Analytics property ID\n  maxPagesToCheck?: number; // Default 20\n  priorityThreshold?: number; // Bara kra sidor ver denna prio\n  useAI?: boolean; // Om AI-analys ska anvndas (default: true)\n  openaiApiKey?: string; // OpenAI API-nyckel\n}\n\nexport interface AgentRunResult {\n  runId: number;\n  pagesChecked: number;\n  avgScore: number;\n  errors: string[];\n  flaggedPages: string[];\n  duration: number; // i sekunder\n}\n\nexport interface PageToCheck {\n  url: string;\n  priority: number;\n  lastScore: number | null;\n  daysSinceLastCheck: number;\n}\n\n/**\n * Huvudfunktion fr att kra SEO-agenten\n * @param config - Agent konfiguration\n * @returns Run resultat\n */\nexport async function runAgent(config: AgentConfig): Promise<AgentRunResult> {\n  const startTime = Date.now();\n  const errors: string[] = [];\n  const flaggedPages: string[] = [];\n\n  console.log('[Agent] Starting SEO agent run...');\n\n  // Skapa ny run i databasen\n  const runId = await createRun();\n  console.log(`[Agent] Created run ID: ${runId}`);\n\n  try {\n    // Steg 1: Hmta sitemap\n    console.log('[Agent] Fetching sitemap...');\n    const sitemapResult = config.sitemapUrl\n      ? await readSitemap(config.sitemapUrl)\n      : await discoverSitemap(config.siteUrl);\n\n    let urlsToProcess: string[] = [];\n\n    if (!sitemapResult.success || sitemapResult.totalUrls === 0) {\n      // Sitemap hittades inte - anvnd bara siteUrl\n      console.warn(`[Agent]  Sitemap not found: ${sitemapResult.error}`);\n      console.log('[Agent] Falling back to checking only the site URL');\n      urlsToProcess = [config.siteUrl];\n    } else {\n      console.log(`[Agent] Found ${sitemapResult.totalUrls} URLs in sitemap`);\n      urlsToProcess = sitemapResult.urls.map(u => u.loc);\n    }\n\n    // Steg 2: Upsertera alla pages frn sitemap eller bara siteUrl\n    for (const url of urlsToProcess) {\n      try {\n        await upsertPage({\n          url: url,\n          last_seen_at: new Date().toISOString(),\n        });\n      } catch (error) {\n        console.error(`Error upserting page ${url}:`, error);\n      }\n    }\n\n    // Steg 3: Berkna prioritering fr alla pages\n    console.log('[Agent] Calculating page priorities...');\n    const allPages = await getAllPages();\n    const pagesToCheck = await selectPagesToCheck(\n      allPages,\n      config.maxPagesToCheck || 20,\n      config.priorityThreshold\n    );\n\n    console.log(`[Agent] Selected ${pagesToCheck.length} pages to check`);\n\n    // Steg 4: Kr audit fr varje vald sida\n    let totalScore = 0;\n    let successCount = 0;\n\n    for (const page of pagesToCheck) {\n      console.log(`[Agent] Checking ${page.url}...`);\n\n      try {\n        const result = await checkPage(page.url, config);\n\n        if (result.success) {\n          // Spara audit\n          await createAudit({\n            run_id: runId,\n            url: page.url,\n            score: result.score,\n            lcp: result.vitals?.lcp || null,\n            cls: result.vitals?.cls || null,\n            inp: result.vitals?.inp || null,\n            issues: result.issues as any,\n          });\n\n          // Uppdatera page metrics\n          await updatePageMetrics(page.url, {\n            senaste_score: result.score,\n            senaste_lcp: result.vitals?.lcp,\n            senaste_cls: result.vitals?.cls,\n            senaste_inp: result.vitals?.inp,\n            last_seen_at: new Date().toISOString(),\n          });\n\n          // Spara frslag\n          for (const suggestion of result.suggestions) {\n            await createSuggestion({\n              url: page.url,\n              action: suggestion.action,\n              impact: suggestion.impact,\n              status: 'pending',\n            });\n          }\n\n          totalScore += result.score;\n          successCount++;\n\n          // Flagga sida om ndvndigt\n          const scoreDiff = page.lastScore ? result.score - page.lastScore : null;\n          if (shouldFlagPage(result.score, result.vitals, scoreDiff)) {\n            flaggedPages.push(page.url);\n            console.log(`[Agent]   Flagged ${page.url} (score: ${result.score})`);\n          }\n        } else {\n          errors.push(`${page.url}: ${result.error}`);\n        }\n\n        // Rate limiting: vnta 2 sekunder mellan checks\n        await new Promise(resolve => setTimeout(resolve, 2000));\n\n      } catch (error) {\n        const errorMsg = error instanceof Error ? error.message : 'Unknown error';\n        errors.push(`${page.url}: ${errorMsg}`);\n        console.error(`[Agent] Error checking ${page.url}:`, error);\n      }\n    }\n\n    // Steg 5: Uppdatera run med resultat\n    const avgScore = successCount > 0 ? totalScore / successCount : 0;\n\n    await updateRun(runId, {\n      finished_at: new Date().toISOString(),\n      pages_checked: successCount,\n      avg_score: avgScore,\n      status: 'completed',\n    });\n\n    // Steg 6: Refresh materialiserade vyer\n    console.log('[Agent] Refreshing materialized views...');\n    await refreshMaterializedViews();\n\n    const duration = (Date.now() - startTime) / 1000;\n\n    console.log('[Agent]  Run completed successfully');\n    console.log(`[Agent] Checked ${successCount} pages in ${duration.toFixed(1)}s`);\n    console.log(`[Agent] Average score: ${avgScore.toFixed(1)}`);\n\n    return {\n      runId,\n      pagesChecked: successCount,\n      avgScore,\n      errors,\n      flaggedPages,\n      duration,\n    };\n\n  } catch (error) {\n    // Markera run som failed\n    await updateRun(runId, {\n      finished_at: new Date().toISOString(),\n      status: 'failed',\n      error_message: error instanceof Error ? error.message : 'Unknown error',\n    });\n\n    throw error;\n  }\n}\n\n/**\n * Vljer sidor att checka baserat p prioritering\n */\nasync function selectPagesToCheck(\n  allPages: any[],\n  maxPages: number,\n  priorityThreshold?: number\n): Promise<PageToCheck[]> {\n  const pagesToCheck: PageToCheck[] = [];\n\n  for (const page of allPages) {\n    // Hmta tidigare audits fr att berkna trend\n    const previousAudits = await getAuditsByUrl(page.url, 2);\n    const lastScore = previousAudits.length > 0 ? previousAudits[0].score : null;\n    const prevScore = previousAudits.length > 1 ? previousAudits[1].score : null;\n\n    // Berkna dagar sedan senaste check\n    const daysSinceLastCheck = page.last_seen_at\n      ? (Date.now() - new Date(page.last_seen_at).getTime()) / (1000 * 60 * 60 * 24)\n      : 999;\n\n    // Berkna prioritet\n    const priority = calculatePriority(\n      page.senaste_score || 50,\n      prevScore,\n      {\n        lcp: page.senaste_lcp || 0,\n        cls: page.senaste_cls || 0,\n        inp: page.senaste_inp || 0,\n      },\n      daysSinceLastCheck\n    );\n\n    // Filtrera p threshold om satt\n    if (priorityThreshold && priority < priorityThreshold) {\n      continue;\n    }\n\n    pagesToCheck.push({\n      url: page.url,\n      priority,\n      lastScore,\n      daysSinceLastCheck,\n    });\n  }\n\n  // Sortera efter prioritet och ta top N\n  pagesToCheck.sort((a, b) => b.priority - a.priority);\n\n  return pagesToCheck.slice(0, maxPages);\n}\n\n/**\n * Kr full check p en enskild sida\n */\nasync function checkPage(\n  url: string,\n  config: AgentConfig\n): Promise<{\n  success: boolean;\n  score: number;\n  vitals?: any;\n  issues: any;\n  suggestions: Array<{ action: string; impact: 'low' | 'medium' | 'high' }>;\n  error?: string;\n}> {\n  try {\n    // Hmta HTML\n    const fetchResult = await fetchUrl({ url });\n\n    if (!fetchResult.success || !fetchResult.html) {\n      return {\n        success: false,\n        score: 0,\n        issues: {},\n        suggestions: [],\n        error: fetchResult.error || 'Failed to fetch HTML',\n      };\n    }\n\n    // On-page analys\n    const onPageResult = analyzeOnPage(fetchResult.html, url);\n\n    // PSI audit\n    const psiResult = await psiAudit(url, config.psiApiKey, 'mobile');\n\n    if (!psiResult.success) {\n      return {\n        success: false,\n        score: 0,\n        issues: {},\n        suggestions: [],\n        error: psiResult.error || 'PSI audit failed',\n      };\n    }\n\n    // GSC data (optional)\n    let gscMetrics;\n    if (config.gscAccessToken && config.gscSiteUrl) {\n      try {\n        const endDate = new Date().toISOString().split('T')[0];\n        const startDate = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)\n          .toISOString()\n          .split('T')[0];\n\n        const gscData = await gscPageData(\n          config.gscSiteUrl,\n          url,\n          config.gscAccessToken,\n          startDate,\n          endDate\n        );\n\n        if (gscData && gscData.impressions > 10) {\n          gscMetrics = {\n            ctr: gscData.ctr,\n            position: gscData.position,\n            impressions: gscData.impressions,\n          };\n        }\n      } catch (error) {\n        console.error('GSC error (non-fatal):', error);\n      }\n    }\n\n    // Berkna total score\n    const scoreBreakdown = calculateSEOScore(\n      onPageResult,\n      psiResult.vitals,\n      gscMetrics\n    );\n\n    // Generera frslag\n    const onPageSuggestions = generateOnPageSuggestions(onPageResult, url);\n    const psiSuggestions = psiResult.issues.map(issue => ({\n      action: issue.title + ': ' + issue.description,\n      impact: issue.impact || 'medium',\n    }));\n\n    const allSuggestions = [...onPageSuggestions, ...psiSuggestions];\n\n    return {\n      success: true,\n      score: scoreBreakdown.total,\n      vitals: psiResult.vitals,\n      issues: {\n        onPage: onPageResult.issues,\n        psi: psiResult.issues,\n        scoreBreakdown,\n      },\n      suggestions: allSuggestions,\n    };\n\n  } catch (error) {\n    return {\n      success: false,\n      score: 0,\n      issues: {},\n      suggestions: [],\n      error: error instanceof Error ? error.message : 'Unknown error',\n    };\n  }\n}\n","// Google Analytics API Integration\r\n// Hmtar trafikdata och anvndarstatistik\r\n\r\nimport { google } from 'googleapis';\r\n\r\nexport interface AnalyticsData {\r\n  pageviews: number;\r\n  uniquePageviews: number;\r\n  avgTimeOnPage: number;\r\n  bounceRate: number;\r\n  exitRate: number;\r\n  conversions?: number;\r\n  dateRange: {\r\n    startDate: string;\r\n    endDate: string;\r\n  };\r\n}\r\n\r\nexport interface AnalyticsPageData {\r\n  pagePath: string;\r\n  pageviews: number;\r\n  uniquePageviews: number;\r\n  avgTimeOnPage: number;\r\n  bounceRate: number;\r\n}\r\n\r\n/**\r\n * Hmtar Analytics data fr en specifik sida\r\n */\r\nexport async function getPageAnalytics(\r\n  propertyId: string,\r\n  pagePath: string,\r\n  startDate: string,\r\n  endDate: string,\r\n  credentials?: unknown\r\n): Promise<AnalyticsData | null> {\r\n  try {\r\n    // Google Analytics Data API v1 (GA4)\r\n    const analyticsData = google.analyticsdata('v1beta');\r\n\r\n    // Autentisering\r\n    const auth = credentials\r\n      ? new google.auth.GoogleAuth({\r\n          credentials: credentials as never,\r\n          scopes: ['https://www.googleapis.com/auth/analytics.readonly'],\r\n        })\r\n      : new google.auth.GoogleAuth({\r\n          scopes: ['https://www.googleapis.com/auth/analytics.readonly'],\r\n        });\r\n\r\n    const authClient = await auth.getClient();\r\n\r\n    // Hmta data\r\n    const response = await analyticsData.properties.runReport({\r\n      property: `properties/${propertyId}`,\r\n      requestBody: {\r\n        dateRanges: [{ startDate, endDate }],\r\n        dimensions: [{ name: 'pagePath' }],\r\n        metrics: [\r\n          { name: 'screenPageViews' },\r\n          { name: 'sessions' },\r\n          { name: 'averageSessionDuration' },\r\n          { name: 'bounceRate' },\r\n        ],\r\n        dimensionFilter: {\r\n          filter: {\r\n            fieldName: 'pagePath',\r\n            stringFilter: {\r\n              matchType: 'EXACT',\r\n              value: pagePath,\r\n            },\r\n          },\r\n        },\r\n      },\r\n      auth: authClient as never,\r\n    });\r\n\r\n    const rows = response.data.rows;\r\n    if (!rows || rows.length === 0) {\r\n      return null;\r\n    }\r\n\r\n    const row = rows[0];\r\n    const metricValues = row.metricValues || [];\r\n\r\n    return {\r\n      pageviews: parseInt(metricValues[0]?.value || '0'),\r\n      uniquePageviews: parseInt(metricValues[1]?.value || '0'),\r\n      avgTimeOnPage: parseFloat(metricValues[2]?.value || '0'),\r\n      bounceRate: parseFloat(metricValues[3]?.value || '0'),\r\n      exitRate: 0, // GA4 berknar inte exitRate p samma stt\r\n      dateRange: { startDate, endDate },\r\n    };\r\n  } catch (error) {\r\n    console.error('[Analytics] Error fetching page data:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Hmtar top pages frn Analytics\r\n */\r\nexport async function getTopPages(\r\n  propertyId: string,\r\n  startDate: string,\r\n  endDate: string,\r\n  limit = 50,\r\n  credentials?: unknown\r\n): Promise<AnalyticsPageData[]> {\r\n  try {\r\n    const analyticsData = google.analyticsdata('v1beta');\r\n\r\n    const auth = credentials\r\n      ? new google.auth.GoogleAuth({\r\n          credentials: credentials as never,\r\n          scopes: ['https://www.googleapis.com/auth/analytics.readonly'],\r\n        })\r\n      : new google.auth.GoogleAuth({\r\n          scopes: ['https://www.googleapis.com/auth/analytics.readonly'],\r\n        });\r\n\r\n    const authClient = await auth.getClient();\r\n\r\n    const response = await analyticsData.properties.runReport({\r\n      property: `properties/${propertyId}`,\r\n      requestBody: {\r\n        dateRanges: [{ startDate, endDate }],\r\n        dimensions: [{ name: 'pagePath' }],\r\n        metrics: [\r\n          { name: 'screenPageViews' },\r\n          { name: 'sessions' },\r\n          { name: 'averageSessionDuration' },\r\n          { name: 'bounceRate' },\r\n        ],\r\n        orderBys: [\r\n          {\r\n            metric: {\r\n              metricName: 'screenPageViews',\r\n            },\r\n            desc: true,\r\n          },\r\n        ],\r\n        limit: limit.toString(),\r\n      },\r\n      auth: authClient as never,\r\n    });\r\n\r\n    const rows = response.data.rows || [];\r\n\r\n    return rows.map((row: any) => {\r\n      const dimensionValues = row.dimensionValues || [];\r\n      const metricValues = row.metricValues || [];\r\n\r\n      return {\r\n        pagePath: dimensionValues[0]?.value || '',\r\n        pageviews: parseInt(metricValues[0]?.value || '0'),\r\n        uniquePageviews: parseInt(metricValues[1]?.value || '0'),\r\n        avgTimeOnPage: parseFloat(metricValues[2]?.value || '0'),\r\n        bounceRate: parseFloat(metricValues[3]?.value || '0'),\r\n      };\r\n    });\r\n  } catch (error) {\r\n    console.error('[Analytics] Error fetching top pages:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Kombinerar GSC + Analytics data fr en komplett bild\r\n */\r\nexport interface CombinedPageData {\r\n  url: string;\r\n  // GSC data\r\n  clicks: number;\r\n  impressions: number;\r\n  ctr: number;\r\n  position: number;\r\n  topQueries: Array<{ query: string; clicks: number }>;\r\n  // Analytics data\r\n  pageviews: number;\r\n  avgTimeOnPage: number;\r\n  bounceRate: number;\r\n  // Berknat\r\n  searchVsDirectRatio: number; // clicks / pageviews\r\n  engagementScore: number; // baserat p time + bounce\r\n}\r\n\r\nexport function combineGSCAndAnalytics(\r\n  gscData: {\r\n    clicks: number;\r\n    impressions: number;\r\n    ctr: number;\r\n    position: number;\r\n    topQueries?: Array<{ query: string; clicks: number }>;\r\n  },\r\n  analyticsData: AnalyticsData | null\r\n): Partial<CombinedPageData> {\r\n  const combined: Partial<CombinedPageData> = {\r\n    clicks: gscData.clicks,\r\n    impressions: gscData.impressions,\r\n    ctr: gscData.ctr,\r\n    position: gscData.position,\r\n    topQueries: gscData.topQueries?.slice(0, 5) || [],\r\n  };\r\n\r\n  if (analyticsData) {\r\n    combined.pageviews = analyticsData.pageviews;\r\n    combined.avgTimeOnPage = analyticsData.avgTimeOnPage;\r\n    combined.bounceRate = analyticsData.bounceRate;\r\n\r\n    // Berkna metrics\r\n    combined.searchVsDirectRatio =\r\n      analyticsData.pageviews > 0 ? gscData.clicks / analyticsData.pageviews : 0;\r\n\r\n    // Engagement score: hg tid + lg bounce = bra\r\n    const timeScore = Math.min(analyticsData.avgTimeOnPage / 180, 1); // Max 3 min\r\n    const bounceScore = 1 - analyticsData.bounceRate / 100;\r\n    combined.engagementScore = (timeScore + bounceScore) / 2;\r\n  }\r\n\r\n  return combined;\r\n}\r\n","// Content Optimizer - AI-driven text suggestions\n// Genererar konkreta textfrslag fr bttre SEO\n\nimport * as cheerio from 'cheerio';\nimport type { SectionType, ImpactLevel } from '../db/types';\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\nexport interface TextSuggestion {\n  section_type: SectionType;\n  section_identifier: string | null;\n  original_text: string | null;\n  suggested_text: string;\n  keywords: string[];\n  keyword_density: Record<string, number>;\n  reason: string;\n  impact: ImpactLevel;\n  seo_score_impact: number;\n  readability_score: number;\n}\n\nexport interface KeywordAnalysis {\n  keyword: string;\n  current_count: number;\n  suggested_count: number;\n  density: number;\n  target_density: number;\n  relevance_score: number;\n  status: 'suggested' | 'optimized' | 'over_used' | 'under_used';\n}\n\nexport interface ContentAnalysisResult {\n  url: string;\n  heading_structure: any;\n  paragraph_count: number;\n  word_count: number;\n  char_count: number;\n  readability_score: number;\n  avg_sentence_length: number;\n  avg_word_length: number;\n  top_keywords: Record<string, number>;\n  keyword_density: Record<string, number>;\n  missing_keywords: string[];\n  sentiment_score: number;\n  tone: string;\n  content_score: number;\n  improvement_areas: string[];\n}\n\n// ============================================================================\n// KEYWORD EXTRACTION & ANALYSIS\n// ============================================================================\n\n// Stop words (vanliga ord att filtrera bort)\nconst STOP_WORDS = new Set([\n  'och', 'i', 'att', 'det', 'som', 'en', 'p', 'r', 'fr', 'med',\n  'till', 'av', 'om', 's', 'den', 'men', 'ett', 'har', 'de', 'var',\n  'vad', 'kan', 'vi', 'inte', 'frn', 'ska', 'eller', 'nr', 'han',\n  'the', 'be', 'to', 'of', 'and', 'a', 'in', 'that', 'have', 'i',\n  'it', 'for', 'not', 'on', 'with', 'he', 'as', 'you', 'do', 'at',\n  'this', 'but', 'his', 'by', 'from', 'they', 'we', 'say', 'her', 'she'\n]);\n\n/**\n * Extraherar nyckelord frn text\n */\nexport function extractKeywords(text: string, topN: number = 10): Record<string, number> {\n  const words = text.toLowerCase()\n    .replace(/[^\\w\\s-]/g, ' ')\n    .split(/\\s+/)\n    .filter(word => word.length > 3 && !STOP_WORDS.has(word));\n\n  const frequency: Record<string, number> = {};\n  words.forEach(word => {\n    frequency[word] = (frequency[word] || 0) + 1;\n  });\n\n  // Sortera och ta top N\n  const sorted = Object.entries(frequency)\n    .sort(([, a], [, b]) => b - a)\n    .slice(0, topN);\n\n  return Object.fromEntries(sorted);\n}\n\n/**\n * Berknar keyword density\n */\nexport function calculateKeywordDensity(text: string, keywords: string[]): Record<string, number> {\n  const words = text.toLowerCase().split(/\\s+/).filter(w => w.length > 0);\n  const totalWords = words.length;\n\n  const density: Record<string, number> = {};\n  keywords.forEach(keyword => {\n    const count = words.filter(w => w.includes(keyword.toLowerCase())).length;\n    density[keyword] = totalWords > 0 ? (count / totalWords) * 100 : 0;\n  });\n\n  return density;\n}\n\n/**\n * Analyserar nyckelord och ger rekommendationer\n */\nexport function analyzeKeywords(text: string, targetKeywords: string[] = []): KeywordAnalysis[] {\n  const extractedKeywords = extractKeywords(text, 15);\n  const words = text.split(/\\s+/).filter(w => w.length > 0);\n  const totalWords = words.length;\n\n  const results: KeywordAnalysis[] = [];\n\n  // Analysera target keywords\n  targetKeywords.forEach(keyword => {\n    const currentCount = (extractedKeywords[keyword.toLowerCase()] || 0);\n    const density = totalWords > 0 ? (currentCount / totalWords) * 100 : 0;\n\n    // Target density: 0.5-2.5% r optimalt\n    let targetDensity = 1.5;\n    let suggestedCount = Math.round(totalWords * (targetDensity / 100));\n    let status: KeywordAnalysis['status'] = 'suggested';\n\n    if (density >= 0.5 && density <= 2.5) {\n      status = 'optimized';\n    } else if (density > 2.5) {\n      status = 'over_used';\n      suggestedCount = Math.round(totalWords * 0.02); // Max 2%\n    } else {\n      status = 'under_used';\n    }\n\n    results.push({\n      keyword,\n      current_count: currentCount,\n      suggested_count: suggestedCount,\n      density,\n      target_density: targetDensity,\n      relevance_score: 85, // Detta kan frbttras med AI\n      status\n    });\n  });\n\n  return results;\n}\n\n// ============================================================================\n// READABILITY ANALYSIS\n// ============================================================================\n\n/**\n * Berknar Flesch Reading Ease score (anpassad fr svenska)\n */\nexport function calculateReadability(text: string): number {\n  const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);\n  const words = text.split(/\\s+/).filter(w => w.length > 0);\n  const syllables = words.reduce((sum, word) => sum + countSyllables(word), 0);\n\n  if (sentences.length === 0 || words.length === 0) return 0;\n\n  const avgWordsPerSentence = words.length / sentences.length;\n  const avgSyllablesPerWord = syllables / words.length;\n\n  // Flesch Reading Ease formula (anpassad)\n  const score = 206.835 - (1.015 * avgWordsPerSentence) - (84.6 * avgSyllablesPerWord);\n\n  return Math.max(0, Math.min(100, score));\n}\n\n/**\n * Rknar stavelser i ord (approximation)\n */\nfunction countSyllables(word: string): number {\n  word = word.toLowerCase();\n  if (word.length <= 3) return 1;\n\n  const vowels = /[aeiouy]/g;\n  const matches = word.match(vowels);\n  return matches ? matches.length : 1;\n}\n\n/**\n * Fr lsbarhetsniv som text\n */\nexport function getReadabilityLevel(score: number): string {\n  if (score >= 90) return 'Mycket ltt';\n  if (score >= 80) return 'Ltt';\n  if (score >= 70) return 'Ganska ltt';\n  if (score >= 60) return 'Standard';\n  if (score >= 50) return 'Ganska svr';\n  if (score >= 30) return 'Svr';\n  return 'Mycket svr';\n}\n\n// ============================================================================\n// TEXT SUGGESTIONS GENERATOR\n// ============================================================================\n\n/**\n * Genererar frbttrat title-frslag\n */\nexport function generateTitleSuggestion(\n  originalTitle: string | null,\n  url: string,\n  keywords: string[]\n): TextSuggestion | null {\n  const title = originalTitle || '';\n  const length = title.length;\n\n  // Optimalt: 50-60 tecken\n  if (length >= 50 && length <= 60 && keywords.some(k => title.toLowerCase().includes(k.toLowerCase()))) {\n    return null; // Title r redan bra\n  }\n\n  let suggestedTitle = title;\n  let reason = '';\n  let impact: ImpactLevel = 'medium';\n  let scoreImpact = 5;\n\n  if (length === 0) {\n    // Skapa ny title frn URL och keywords\n    const pageName = url.split('/').pop()?.replace(/[-_]/g, ' ') || 'Hem';\n    suggestedTitle = `${keywords[0] || pageName} | Professional Services`;\n    reason = 'Title saknas helt. Skapad baserat p URL och keywords.';\n    impact = 'high';\n    scoreImpact = 20;\n  } else if (length < 50) {\n    // Fr kort - lgg till keywords\n    const missingKeyword = keywords.find(k => !title.toLowerCase().includes(k.toLowerCase()));\n    if (missingKeyword) {\n      suggestedTitle = `${title} - ${missingKeyword}`;\n    }\n    reason = `Title r fr kort (${length} tecken). Optimalt r 50-60 tecken.`;\n    impact = 'medium';\n    scoreImpact = 10;\n  } else if (length > 60) {\n    // Fr lng - korta ner\n    suggestedTitle = title.substring(0, 57) + '...';\n    reason = `Title r fr lng (${length} tecken). Trunkerad till 60 tecken.`;\n    impact = 'medium';\n    scoreImpact = 8;\n  } else {\n    // Rtt lngd men saknar keywords\n    const missingKeyword = keywords.find(k => !title.toLowerCase().includes(k.toLowerCase()));\n    if (missingKeyword) {\n      suggestedTitle = `${missingKeyword} | ${title}`.substring(0, 60);\n      reason = 'Title saknar huvudnyckelord. Lagt till fr bttre ranking.';\n      impact = 'high';\n      scoreImpact = 15;\n    } else {\n      return null;\n    }\n  }\n\n  return {\n    section_type: 'title',\n    section_identifier: 'title',\n    original_text: title,\n    suggested_text: suggestedTitle,\n    keywords: keywords.filter(k => suggestedTitle.toLowerCase().includes(k.toLowerCase())),\n    keyword_density: calculateKeywordDensity(suggestedTitle, keywords),\n    reason,\n    impact,\n    seo_score_impact: scoreImpact,\n    readability_score: 100 // Titles r enkla\n  };\n}\n\n/**\n * Genererar frbttrat meta description-frslag\n */\nexport function generateMetaDescriptionSuggestion(\n  originalDesc: string | null,\n  pageContent: string,\n  keywords: string[]\n): TextSuggestion | null {\n  const desc = originalDesc || '';\n  const length = desc.length;\n\n  // Optimalt: 140-160 tecken med CTA\n  if (length >= 140 && length <= 160 &&\n      keywords.some(k => desc.toLowerCase().includes(k.toLowerCase())) &&\n      /ls mer|kontakta|upptck|ls|se|besk|kp/i.test(desc)) {\n    return null; // Redan bra\n  }\n\n  let suggestedDesc = desc;\n  let reason = '';\n  let impact: ImpactLevel = 'medium';\n  let scoreImpact = 5;\n\n  if (length === 0) {\n    // Skapa frn sidinnehll\n    const firstParagraph = pageContent.split('.')[0] || '';\n    const keywordPhrase = keywords.slice(0, 2).join(' och ');\n    suggestedDesc = `Upptck ${keywordPhrase}. ${firstParagraph.substring(0, 100)}... Ls mer hr!`;\n    suggestedDesc = suggestedDesc.substring(0, 160);\n    reason = 'Meta description saknas. Skapad frn sidinnehll med keywords och CTA.';\n    impact = 'high';\n    scoreImpact = 20;\n  } else if (length < 140) {\n    // Fr kort - utka med keywords och CTA\n    const missingKeywords = keywords.filter(k => !desc.toLowerCase().includes(k.toLowerCase()));\n    if (missingKeywords.length > 0) {\n      suggestedDesc = `${desc} Inkluderar ${missingKeywords[0]}. Ls mer!`;\n    } else {\n      suggestedDesc = `${desc} Ls mer hr!`;\n    }\n    suggestedDesc = suggestedDesc.substring(0, 160);\n    reason = `Meta description r fr kort (${length} tecken). Utkad till 140-160 tecken med CTA.`;\n    impact = 'medium';\n    scoreImpact = 12;\n  } else if (length > 160) {\n    // Fr lng - korta ner men behll keywords\n    const keywordPart = keywords.find(k => desc.toLowerCase().includes(k.toLowerCase())) || '';\n    suggestedDesc = desc.substring(0, 145) + '... Ls mer!';\n    reason = `Meta description r fr lng (${length} tecken). Kortad till 160 tecken.`;\n    impact = 'medium';\n    scoreImpact = 8;\n  } else {\n    // Rtt lngd men saknar CTA eller keywords\n    if (!/ls mer|kontakta|upptck|ls|se|besk|kp/i.test(desc)) {\n      suggestedDesc = desc.substring(0, 145) + ' Ls mer!';\n      reason = 'Lagt till call-to-action fr bttre CTR.';\n      impact = 'low';\n      scoreImpact = 5;\n    }\n  }\n\n  return {\n    section_type: 'meta_description',\n    section_identifier: 'meta[name=\"description\"]',\n    original_text: desc,\n    suggested_text: suggestedDesc,\n    keywords: keywords.filter(k => suggestedDesc.toLowerCase().includes(k.toLowerCase())),\n    keyword_density: calculateKeywordDensity(suggestedDesc, keywords),\n    reason,\n    impact,\n    seo_score_impact: scoreImpact,\n    readability_score: calculateReadability(suggestedDesc)\n  };\n}\n\n/**\n * Genererar frbttringsfrslag fr rubriker (H1-H4)\n */\nexport function generateHeadingSuggestion(\n  headingLevel: 'h1' | 'h2' | 'h3' | 'h4',\n  originalText: string,\n  keywords: string[],\n  index: number\n): TextSuggestion | null {\n  const text = originalText.trim();\n\n  // H1 r mest viktig\n  if (headingLevel === 'h1') {\n    // H1 borde innehlla huvudnyckelord\n    if (!keywords.some(k => text.toLowerCase().includes(k.toLowerCase()))) {\n      const suggestedText = `${keywords[0]}: ${text}`;\n      return {\n        section_type: 'h1',\n        section_identifier: `h1:nth-of-type(${index + 1})`,\n        original_text: text,\n        suggested_text: suggestedText,\n        keywords: [keywords[0]],\n        keyword_density: calculateKeywordDensity(suggestedText, keywords),\n        reason: 'H1 saknar huvudnyckelord. Detta r kritiskt fr SEO.',\n        impact: 'high',\n        seo_score_impact: 15,\n        readability_score: calculateReadability(suggestedText)\n      };\n    }\n  }\n\n  // H2-H4: Kolla lngd och keywords\n  if (text.length < 20) {\n    const relevantKeyword = keywords.find(k => !text.toLowerCase().includes(k.toLowerCase()));\n    if (relevantKeyword) {\n      return {\n        section_type: headingLevel,\n        section_identifier: `${headingLevel}:nth-of-type(${index + 1})`,\n        original_text: text,\n        suggested_text: `${text} - ${relevantKeyword}`,\n        keywords: [relevantKeyword],\n        keyword_density: calculateKeywordDensity(`${text} - ${relevantKeyword}`, keywords),\n        reason: `${headingLevel.toUpperCase()} r fr kort. Lagt till nyckelord fr kontext.`,\n        impact: 'low',\n        seo_score_impact: 3,\n        readability_score: 90\n      };\n    }\n  }\n\n  return null;\n}\n\n// ============================================================================\n// FULL CONTENT ANALYSIS\n// ============================================================================\n\n/**\n * Analyserar fullstndigt sidinnehll\n */\nexport async function analyzePageContent(html: string, url: string): Promise<ContentAnalysisResult> {\n  const $ = cheerio.load(html);\n\n  // Ta bort script och style\n  $('script, style, noscript').remove();\n\n  const bodyText = $('body').text().trim();\n  const words = bodyText.split(/\\s+/).filter(w => w.length > 0);\n  const sentences = bodyText.split(/[.!?]+/).filter(s => s.trim().length > 0);\n\n  // Heading struktur\n  const headingStructure: any[] = [];\n  $('h1, h2, h3, h4, h5, h6').each((i, elem) => {\n    headingStructure.push({\n      level: elem.tagName,\n      text: $(elem).text().trim(),\n      index: i\n    });\n  });\n\n  // Paragraphs\n  const paragraphCount = $('p').length;\n\n  // Keywords\n  const topKeywords = extractKeywords(bodyText, 20);\n  const keywordDensity = calculateKeywordDensity(bodyText, Object.keys(topKeywords).slice(0, 10));\n\n  // Readability\n  const readabilityScore = calculateReadability(bodyText);\n  const avgSentenceLength = words.length / Math.max(sentences.length, 1);\n  const avgWordLength = words.reduce((sum, w) => sum + w.length, 0) / Math.max(words.length, 1);\n\n  // Content score (0-100)\n  let contentScore = 70; // Base score\n\n  // Deduct fr problem\n  if (words.length < 300) contentScore -= 20; // Fr lite innehll\n  if (headingStructure.length === 0) contentScore -= 15; // Inga rubriker\n  if (paragraphCount < 3) contentScore -= 10; // Fr f paragrafer\n  if (readabilityScore < 50) contentScore -= 10; // Svrlst\n\n  // Frbttringsomrden\n  const improvementAreas: string[] = [];\n  if (words.length < 300) improvementAreas.push('Lgg till mer innehll (minst 300 ord)');\n  if (headingStructure.length === 0) improvementAreas.push('Lgg till rubriker (H1-H4)');\n  if (paragraphCount < 3) improvementAreas.push('Dela upp text i fler paragrafer');\n  if (readabilityScore < 50) improvementAreas.push('Frenkla sprket fr bttre lsbarhet');\n  if (avgSentenceLength > 25) improvementAreas.push('Korta ner meningarna');\n\n  return {\n    url,\n    heading_structure: headingStructure,\n    paragraph_count: paragraphCount,\n    word_count: words.length,\n    char_count: bodyText.length,\n    readability_score: readabilityScore,\n    avg_sentence_length: avgSentenceLength,\n    avg_word_length: avgWordLength,\n    top_keywords: topKeywords,\n    keyword_density: keywordDensity,\n    missing_keywords: [], // Detta kan frbttras med konkurrenssanalys\n    sentiment_score: 0.5, // Neutral - kan frbttras med sentiment analysis\n    tone: avgWordLength > 6 ? 'professional' : 'casual',\n    content_score: Math.max(0, Math.min(100, contentScore)),\n    improvement_areas: improvementAreas\n  };\n}\n\n/**\n * Genererar alla textfrslag fr en sida\n */\nexport async function generateAllSuggestions(\n  html: string,\n  url: string,\n  targetKeywords: string[] = []\n): Promise<TextSuggestion[]> {\n  const $ = cheerio.load(html);\n  const suggestions: TextSuggestion[] = [];\n\n  // Extrahera automatiska keywords om inga ges\n  const bodyText = $('body').text();\n  const keywords = targetKeywords.length > 0\n    ? targetKeywords\n    : Object.keys(extractKeywords(bodyText, 5));\n\n  // Title\n  const title = $('title').text();\n  const titleSuggestion = generateTitleSuggestion(title, url, keywords);\n  if (titleSuggestion) suggestions.push(titleSuggestion);\n\n  // Meta description\n  const metaDesc = $('meta[name=\"description\"]').attr('content') || null;\n  const descSuggestion = generateMetaDescriptionSuggestion(metaDesc, bodyText, keywords);\n  if (descSuggestion) suggestions.push(descSuggestion);\n\n  // H1 headings\n  $('h1').each((i, elem) => {\n    const h1Suggestion = generateHeadingSuggestion('h1', $(elem).text(), keywords, i);\n    if (h1Suggestion) suggestions.push(h1Suggestion);\n  });\n\n  // H2 headings (max 5)\n  $('h2').slice(0, 5).each((i, elem) => {\n    const h2Suggestion = generateHeadingSuggestion('h2', $(elem).text(), keywords, i);\n    if (h2Suggestion) suggestions.push(h2Suggestion);\n  });\n\n  // H3 headings (max 3)\n  $('h3').slice(0, 3).each((i, elem) => {\n    const h3Suggestion = generateHeadingSuggestion('h3', $(elem).text(), keywords, i);\n    if (h3Suggestion) suggestions.push(h3Suggestion);\n  });\n\n  return suggestions;\n}\n","import axios, { AxiosInstance } from 'axios';\n\nconst FETCHSERP_API_URL = 'https://www.fetchserp.com';\n\nexport interface FetchSERPConfig {\n  apiToken: string;\n}\n\nexport interface SERPParams {\n  q: string;\n  engine?: 'google' | 'bing' | 'yahoo' | 'duckduckgo';\n  gl?: string;\n  hl?: string;\n  num?: number;\n  page?: number;\n}\n\nexport interface KeywordVolumeParams {\n  keywords: string[];\n  country?: string;\n  language?: string;\n}\n\nexport interface BacklinksParams {\n  domain: string;\n  limit?: number;\n}\n\nexport interface DomainInfoParams {\n  domain: string;\n}\n\nexport interface ScrapeParams {\n  url: string;\n  headers?: Record<string, string>;\n}\n\nexport interface ScrapeJSParams {\n  url: string;\n  js_code: string;\n  headers?: Record<string, string>;\n}\n\nexport interface SEOAnalysisParams {\n  url: string;\n  keywords?: string[];\n}\n\nexport interface AIAnalysisParams {\n  url: string;\n  prompt: string;\n}\n\nexport interface RankingParams {\n  domain: string;\n  keyword: string;\n  engine?: string;\n  gl?: string;\n}\n\nexport interface PageIndexationParams {\n  url: string;\n  engine?: string;\n}\n\nexport class FetchSERPClient {\n  private client: AxiosInstance;\n\n  constructor(config: FetchSERPConfig) {\n    this.client = axios.create({\n      baseURL: FETCHSERP_API_URL,\n      headers: {\n        'Authorization': `Bearer ${config.apiToken}`,\n        'Content-Type': 'application/json',\n      },\n    });\n  }\n\n  // ==================== SERP Endpoints ====================\n\n  /**\n   * Get structured SERP results\n   */\n  async getSERP(params: SERPParams) {\n    const response = await this.client.get('/api/v1/serp', { params });\n    return response.data;\n  }\n\n  /**\n   * Get SERP results with full HTML\n   */\n  async getSERPHTML(params: SERPParams) {\n    const response = await this.client.get('/api/v1/serp_html', { params });\n    return response.data;\n  }\n\n  /**\n   * Get SERP results with extracted text\n   */\n  async getSERPText(params: SERPParams) {\n    const response = await this.client.get('/api/v1/serp_text', { params });\n    return response.data;\n  }\n\n  /**\n   * Get JavaScript-rendered SERP with AI Overview\n   */\n  async getSERPJS(params: SERPParams) {\n    const response = await this.client.get('/api/v1/serp_js', { params });\n    return response.data;\n  }\n\n  /**\n   * Get AI Overview and AI Mode results\n   */\n  async getSERPAI(params: SERPParams) {\n    const response = await this.client.get('/api/v1/serp_ai', { params });\n    return response.data;\n  }\n\n  /**\n   * Get cached US-only AI Mode results\n   */\n  async getSERPAIMode(params: SERPParams) {\n    const response = await this.client.get('/api/v1/serp_ai_mode', { params });\n    return response.data;\n  }\n\n  // ==================== Keyword Research Endpoints ====================\n\n  /**\n   * Get monthly search volume and competition metrics\n   */\n  async getKeywordsSearchVolume(params: KeywordVolumeParams) {\n    const response = await this.client.post('/api/v1/keywords_search_volume', params);\n    return response.data;\n  }\n\n  /**\n   * Get keyword suggestions with metrics\n   */\n  async getKeywordsSuggestions(params: { keyword: string; country?: string; language?: string }) {\n    const response = await this.client.get('/api/v1/keywords_suggestions', { params });\n    return response.data;\n  }\n\n  /**\n   * Generate long-tail keyword variations\n   */\n  async getLongTailKeywords(params: { keyword: string; country?: string; language?: string }) {\n    const response = await this.client.get('/api/v1/long_tail_keywords_generator', { params });\n    return response.data;\n  }\n\n  // ==================== Domain Analysis Endpoints ====================\n\n  /**\n   * Get domain ranking for specific keywords\n   */\n  async getDomainRanking(params: RankingParams) {\n    const response = await this.client.get('/api/v1/ranking', { params });\n    return response.data;\n  }\n\n  /**\n   * Get backlink data for a domain\n   */\n  async getBacklinks(params: BacklinksParams) {\n    const response = await this.client.get('/api/v1/backlinks', { params });\n    return response.data;\n  }\n\n  /**\n   * Get DNS, WHOIS, and tech stack information\n   */\n  async getDomainInfo(params: DomainInfoParams) {\n    const response = await this.client.get('/api/v1/domain_infos', { params });\n    return response.data;\n  }\n\n  /**\n   * Extract emails from SERP results\n   */\n  async getDomainEmails(params: { query: string; engine?: string }) {\n    const response = await this.client.get('/api/v1/domain_emails', { params });\n    return response.data;\n  }\n\n  /**\n   * Get Moz domain authority metrics\n   */\n  async getMozMetrics(params: { domain: string }) {\n    const response = await this.client.get('/api/v1/moz', { params });\n    return response.data;\n  }\n\n  /**\n   * Check page indexation status\n   */\n  async getPageIndexation(params: PageIndexationParams) {\n    const response = await this.client.get('/api/v1/page_indexation', { params });\n    return response.data;\n  }\n\n  // ==================== Web Scraping Endpoints ====================\n\n  /**\n   * Get raw HTML without JavaScript\n   */\n  async scrape(params: ScrapeParams) {\n    const response = await this.client.post('/api/v1/scrape', params);\n    return response.data;\n  }\n\n  /**\n   * Custom JavaScript extraction\n   */\n  async scrapeJS(params: ScrapeJSParams) {\n    const response = await this.client.post('/api/v1/scrape_js', params);\n    return response.data;\n  }\n\n  /**\n   * JS extraction through proxy\n   */\n  async scrapeJSWithProxy(params: ScrapeJSParams) {\n    const response = await this.client.post('/api/v1/scrape_js_with_proxy', params);\n    return response.data;\n  }\n\n  /**\n   * Crawl entire domain\n   */\n  async scrapeDomain(params: { domain: string; max_pages?: number }) {\n    const response = await this.client.post('/api/v1/scrape_domain', params);\n    return response.data;\n  }\n\n  // ==================== Analysis Endpoints ====================\n\n  /**\n   * Technical & on-page SEO audit\n   */\n  async analyzeSEO(params: SEOAnalysisParams) {\n    const response = await this.client.post('/api/v1/web_page_seo_analysis', params);\n    return response.data;\n  }\n\n  /**\n   * AI-powered content analysis\n   */\n  async analyzeWithAI(params: AIAnalysisParams) {\n    const response = await this.client.post('/api/v1/web_page_ai_analysis', params);\n    return response.data;\n  }\n\n  // ==================== User Endpoints ====================\n\n  /**\n   * Get current user information\n   */\n  async getUser() {\n    const response = await this.client.get('/api/v1/user');\n    return response.data;\n  }\n}\n\n// Export singleton instance\nlet fetchSERPClient: FetchSERPClient | null = null;\n\nexport function getFetchSERPClient(): FetchSERPClient {\n  if (!fetchSERPClient) {\n    const apiToken = process.env.FETCHSERP_API_TOKEN;\n    if (!apiToken) {\n      throw new Error('FETCHSERP_API_TOKEN is not defined in environment variables');\n    }\n    fetchSERPClient = new FetchSERPClient({ apiToken });\n  }\n  return fetchSERPClient;\n}\n"]}